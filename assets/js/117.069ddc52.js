(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{727:function(e,t,a){"use strict";a.r(t);var s=a(1),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"move-to-production"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#move-to-production"}},[e._v("#")]),e._v(" Move to Production")]),e._v(" "),a("p",[e._v("How would you apply what you learned about "),a("RouterLink",{attrs:{to:"/hands-on-exercise/5-run-in-prod/0-overview.html"}},[e._v("running in production")]),e._v(" to your checkers blockchain?")],1),e._v(" "),a("h2",{attrs:{id:"prepare-the-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-the-node"}},[e._v("#")]),e._v(" Prepare the node")]),e._v(" "),a("p",[e._v("On each of your nodes, create a new user:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBzdWRvIGFkZHVzZXIgY2hlY2tlcnN1c2VyCg=="}}),e._v(" "),a("p",[e._v("Validators are going to use three different computers:")]),e._v(" "),a("ul",[a("li",[e._v("A high-availability node server, typically running on a cloud service.")]),e._v(" "),a("li",[e._v("A high-availability key management server, typically accessible by and running close to the operator.")]),e._v(" "),a("li",[e._v("A desktop computer to manage both servers.")])]),e._v(" "),a("h2",{attrs:{id:"prepare-executables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-executables"}},[e._v("#")]),e._v(" Prepare executables")]),e._v(" "),a("p",[e._v("Now, take a closer look at how to prepare the executables.")]),e._v(" "),a("h3",{attrs:{id:"compilation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compilation"}},[e._v("#")]),e._v(" Compilation")]),e._v(" "),a("p",[e._v("This takes place on the desktop computer. Add a "),a("code",[e._v("Makefile")]),e._v(" for the targets you want to support:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"make",base64:"YnVpbGQtYWxsOgoJR09PUz1saW51eCBHT0FSQ0g9YW1kNjQgZ28gYnVpbGQgLW8gLi9idWlsZC9jaGVja2Vyc2QtbGludXgtYW1kNjQgLi9jbWQvY2hlY2tlcnNkL21haW4uZ28KCUdPT1M9bGludXggR09BUkNIPWFybTY0IGdvIGJ1aWxkIC1vIC4vYnVpbGQvY2hlY2tlcnNkLWxpbnV4LWFybTY0IC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCglHT09TPWRhcndpbiBHT0FSQ0g9YW1kNjQgZ28gYnVpbGQgLW8gLi9idWlsZC9jaGVja2Vyc2QtZGFyd2luLWFtZDY0IC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCgpkby1jaGVja3N1bToKCWNkIGJ1aWxkICZhbXA7JmFtcDsgc2hhMjU2c3VtIGNoZWNrZXJzZC1saW51eC1hbWQ2NCBjaGVja2Vyc2QtbGludXgtYXJtNjQgY2hlY2tlcnNkLWRhcndpbi1hbWQ2NCAmZ3Q7IGNoZWNrZXJzX2NoZWNrc3VtCgpidWlsZC13aXRoLWNoZWNrc3VtOiBidWlsZC1hbGwgZG8tY2hlY2tzdW0K"}}),e._v(" "),a("p",[e._v("Add "),a("code",[e._v("build")]),e._v(" to "),a("code",[e._v(".gitignore")]),e._v(". Now run:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBtYWtlIGJ1aWxkLXdpdGgtY2hlY2tzdW0K"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IC12ICQocHdkKTovY2hlY2tlcnMgLXcgL2NoZWNrZXJzIGNoZWNrZXJzX2kgbWFrZSBidWlsZC13aXRoLWNoZWNrc3VtCg=="}})],1)],1),e._v(" "),a("h3",{attrs:{id:"sharing-and-download"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sharing-and-download"}},[e._v("#")]),e._v(" Sharing and download")]),e._v(" "),a("p",[e._v("Make these files publicly downloadable.")]),e._v(" "),a("p",[e._v("Download them to the node servers, including the validator nodes, and put them in place. You can use a new script "),a("code",[e._v("prepare-node.sh")]),e._v(" that describes the steps:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"Y3AgLXYgL2NoZWNrZXJzL2J1aWxkL2NoZWNrZXJzZC1saW51eC1hbWQ2NCAvdXNyL2xvY2FsL2Jpbi9jaGVja2Vyc2QKYWRkdXNlciAtLWhvbWUgL2hvbWUvY2hlY2tlcnN1c2VyIC0tZGlzYWJsZWQtbG9naW4gLS1kaXNhYmxlZC1wYXNzd29yZCBjaGVja2Vyc3VzZXIK"}}),e._v(" "),a("p",[e._v("Now run the script on the node:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Linux",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAvY2hlY2tlcnMvcHJvZC9wcmVwYXJlLW5vZGUuc2gK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Mac"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IC12ICQocHdkKTovY2hlY2tlcnMgLXcgL2NoZWNrZXJzIGNoZWNrZXJzX2kgcHJvZC9wcmVwYXJlLW5vZGUuc2gK"}})],1)],1),e._v(" "),a("h3",{attrs:{id:"as-a-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#as-a-service"}},[e._v("#")]),e._v(" As a service")]),e._v(" "),a("p",[e._v("Prepare to run the executable as a service. Create a "),a("code",[e._v("/etc/systemd/system/checkersd.service")]),e._v(" file with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ini",base64:"W1VuaXRdCkRlc2NyaXB0aW9uPUNoZWNrZXJzIENoYWluIERhZW1vbgpBZnRlcj1uZXR3b3JrLW9ubGluZS50YXJnZXQKCltTZXJ2aWNlXQpVc2VyPWNoZWNrZXJzdXNlcgpFeGVjU3RhcnQ9JCh3aGljaCBjaGVja2Vyc2QpIHN0YXJ0ClJlc3RhcnQ9YWx3YXlzClJlc3RhcnRTZWM9MwpMaW1pdE5PRklMRT00MDk2CgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQK"}}),e._v(" "),a("h2",{attrs:{id:"prepare-keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-keys"}},[e._v("#")]),e._v(" Prepare keys")]),e._v(" "),a("HighlightBox",{attrs:{type:"info"}},[a("p",[a("strong",[e._v("This only applies to validators.")])])]),e._v(" "),a("p",[e._v("On the key management server, the validator operator installs the Tendermint KMS and gets the consensus key - for instance "),a("code",[e._v('{"@type":"/cosmos.crypto.ed25519.PubKey","key":"byefX/uKpgTsyrcAZKrmYYoFiXG0tmTOOaJFziO3D+E="}')]),e._v(".")]),e._v(" "),a("p",[e._v("Prepare the key management server to be able to connect to the node server.")]),e._v(" "),a("p",[e._v("On the desktop computer, select the keyring you want to use.")]),e._v(" "),a("h2",{attrs:{id:"prepare-the-genesis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-the-genesis"}},[e._v("#")]),e._v(" Prepare the genesis")]),e._v(" "),a("p",[e._v("Now focus on preparing the genesis to continue to prepare to run your checkers blockchain in production. It involves some back and forth.")]),e._v(" "),a("h3",{attrs:{id:"centralized-creation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centralized-creation"}},[e._v("#")]),e._v(" Centralized creation")]),e._v(" "),a("p",[e._v("The validator operator that is in charge of assembling the genesis creates it on the node server:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBzdSAtbCBjaGVja2VydXNlciBjaGVja2Vyc2QgaW5pdCAtLWNoYWluLWlkIGNoZWNrZXJzIC0tc3Rha2luZy1ib25kLWRlbm9tIHVwYXduCg=="}}),e._v(" "),a("p",[e._v("Next, they attribute the initial stakes of everyone, including the validators, by running as many times as necessary:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBzdSAtbCBjaGVja2VydXNlciBjaGVja2Vyc2QgYWRkLWdlbmVzaXMtYWNjb3VudCBjb3Ntb3Mxbnc3OTNqOXh2ZHpsMnVjOWx5OGZhczV0Y2Z3ZmV0ZXJjcGRmcXEgNTAwMDAwMDAwMHVwYXduCg=="}}),e._v(" "),a("p",[e._v("Then they make it publicly downloadable.")]),e._v(" "),a("h3",{attrs:{id:"first-distribution-to-validators"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#first-distribution-to-validators"}},[e._v("#")]),e._v(" First distribution to validators")]),e._v(" "),a("p",[e._v("Each validator node operator downloads this genesis to their desktop computer and:")]),e._v(" "),a("ol",[a("li",[e._v("Confirms their address is present and has the right balance.")]),e._v(" "),a("li",[e._v("Checks their account number, say "),a("code",[e._v("12")]),e._v(".")])]),e._v(" "),a("p",[e._v("Then for their address, they need to create the genesis transaction:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgZ2VudHggY29zbW9zMW53Nzkzajl4dmR6bDJ1YzlseThmYXM1dGNmd2ZldGVyY3BkZnFxIFwKICAgIDMwMDAwMDAwMDB1cGF3biBcCiAgICAtLWFjY291bnQtbnVtYmVyIDEyIC0tc2VxdWVuY2UgMCBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzIFwKICAgIC0tcHVia2V5ICd7JnF1b3Q7QHR5cGUmcXVvdDs6JnF1b3Q7L2Nvc21vcy5jcnlwdG8uZWQyNTUxOS5QdWJLZXkmcXVvdDssJnF1b3Q7a2V5JnF1b3Q7OiZxdW90O2J5ZWZYL3VLcGdUc3lyY0FaS3JtWVlvRmlYRzB0bVRPT2FKRnppTzNEK0U9JnF1b3Q7fScK"}}),e._v(" "),a("p",[e._v("Then each validator sends the new file found in "),a("code",[e._v("~/.checkers/config/gentx")]),e._v(" back to the operator that centralizes the creation of the genesis.")]),e._v(" "),a("h3",{attrs:{id:"addition-of-genesis-transactions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#addition-of-genesis-transactions"}},[e._v("#")]),e._v(" Addition of genesis transactions")]),e._v(" "),a("p",[e._v("The centralized operator now puts all the received genesis transactions on the node server in their own "),a("code",[e._v("/home/checkersuser/config/gentx")]),e._v(". When they have all or enough of them by weight, they do:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBzdSAtbCBjaGVja2VydXNlciBjaGVja2Vyc2QgY29sbGVjdC1nZW50eHMK"}}),e._v(" "),a("p",[e._v("They make this publicly available for everyone, including non-validators.")]),e._v(" "),a("h3",{attrs:{id:"final-distribution-to-operators"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#final-distribution-to-operators"}},[e._v("#")]),e._v(" Final distribution to operators")]),e._v(" "),a("p",[e._v("All operators download this genesis to their node servers, scrutinize it for confirmation that it conforms to their expectations, and put it in their own "),a("code",[e._v("/home/checkersuser/.checkers/config/genesis.json")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"prepare-the-network"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-the-network"}},[e._v("#")]),e._v(" Prepare the network")]),e._v(" "),a("p",[e._v("Socially, operators exchange their addresses and ports with each other as they see fit. Presumably, they do not create two separate networks but a single one eventually.")]),e._v(" "),a("p",[e._v("They save their choices in "),a("code",[e._v("/home/checkersuser/.checkers/config/config.toml")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"launch-the-executable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#launch-the-executable"}},[e._v("#")]),e._v(" Launch the executable")]),e._v(" "),a("p",[e._v("Here, each operator is free to architect their nodes as sentry, seed, or other types as they please.")]),e._v(" "),a("p",[e._v("Around the time that has been agreed on to start the network, they all enable the service:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBzdWRvIHN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCiQgc3VkbyBzeXN0ZW1jdGwgZW5hYmxlIGNoZWNrZXJzZAokIHN1ZG8gc3lzdGVtY3RsIHN0YXJ0IGNoZWNrZXJzZAo="}}),e._v(" "),a("p",[e._v("When 2/3rds of the validators by weight are online, the network starts off the genesis.")]),e._v(" "),a("HighlightBox",{attrs:{type:"synopsis"}},[a("p",[e._v("To summarize, this section has explored:")]),e._v(" "),a("ul",[a("li",[e._v("Applying the knowledge you have gained in the practical exercises to the checkers blockchain.")]),e._v(" "),a("li",[e._v("How to prepare the necessary new users for the different nodes.")]),e._v(" "),a("li",[e._v("How to prepare, share, and run the executables that must be downloaded to the validators' servers.")]),e._v(" "),a("li",[e._v("How to run the executable as a service.")]),e._v(" "),a("li",[e._v("How to prepare keys (only applies to validators).")]),e._v(" "),a("li",[e._v("How to prepare the genesis on the node server and distribute it to validators.")]),e._v(" "),a("li",[e._v("How to add the genesis transactions returned by the validators and make it available to all nodes.")]),e._v(" "),a("li",[e._v("How to prepare the network and launch the executable.")])])])],1)}),[],!1,null,null,null);t.default=o.exports}}]);