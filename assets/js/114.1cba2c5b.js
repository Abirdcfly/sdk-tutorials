(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{728:function(e,t,a){"use strict";a.r(t);var o=a(1),l=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"make-a-module-ibc-enabled"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#make-a-module-ibc-enabled"}},[e._v("#")]),e._v(" Make a module IBC-enabled")]),e._v(" "),a("p",[e._v("In this section, you'll build a conceptual SDK blockchain with one module in two ways. The first time will be a regular module, and the second time will be an IBC module. This will demonstrate what makes a module IBC enabled.")]),e._v(" "),a("h2",{attrs:{id:"scaffold-a-leaderboard-chain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scaffold-a-leaderboard-chain"}},[e._v("#")]),e._v(" Scaffold a Leaderboard chain")]),e._v(" "),a("p",[e._v("By now, you are familiar with scaffolding a chain with Ignite CLI. If not, check out the "),a("a",{attrs:{href:"insert_link"}},[e._v("Create Your Own Chain")]),e._v(" section.")]),e._v(" "),a("p",[e._v("First scaffold a "),a("code",[e._v("leaderboard")]),e._v(" chain:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"aWduaXRlIHNjYWZmb2xkIGNoYWluIGdpdGh1Yi5jb20vY29zbW9uYXV0L2xlYWRlcmJvYXJkCg=="}}),e._v(" "),a("p",[e._v("This creates a chain with "),a("code",[e._v("x/leaderboard")]),e._v(" as a regular SDK module.")]),e._v(" "),a("p",[e._v("Next, scaffold another chain (for example in another git branch) but add the "),a("code",[e._v("--no-module")]),e._v(" flag:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"aWduaXRlIHNjYWZmb2xkIGNoYWluIGdpdGh1Yi5jb20vY29zbW9uYXV0L2xlYWRlcmJvYXJkIC0tbm8tbW9kdWxlCg=="}}),e._v(" "),a("p",[e._v("Now you can add the "),a("code",[e._v("x/leaderboard")]),e._v(" module as an IBC module with the "),a("code",[e._v("--ibc")]),e._v(" flag:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"aWduaXRlIHNjYWZmb2xkIG1vZHVsZSBsZWFkZXJib2FyZCAtLWliYwo="}}),e._v(" "),a("p",[e._v("The output shown on the terminal when the module has finished scaffolding already gives a sense of what has to be implemented to create an IBC module:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"bW9kaWZ5IGFwcC9hcHAuZ28KbW9kaWZ5IHByb3RvL2xlYWRlcmJvYXJkL2dlbmVzaXMucHJvdG8KY3JlYXRlIHByb3RvL2xlYWRlcmJvYXJkL3BhY2tldC5wcm90bwptb2RpZnkgdGVzdHV0aWwva2VlcGVyL2xlYWRlcmJvYXJkLmdvCm1vZGlmeSB4L2xlYWRlcmJvYXJkL2dlbmVzaXMuZ28KY3JlYXRlIHgvbGVhZGVyYm9hcmQvbW9kdWxlX2liYy5nbwpjcmVhdGUgeC9sZWFkZXJib2FyZC90eXBlcy9ldmVudHNfaWJjLmdvCm1vZGlmeSB4L2xlYWRlcmJvYXJkL3R5cGVzL2dlbmVzaXMuZ28KbW9kaWZ5IHgvbGVhZGVyYm9hcmQvdHlwZXMva2V5cy5nbwo="}}),e._v(" "),a("p",[e._v("For a more detailed view, compare both versions with a "),a("code",[e._v("git diff")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"ibc-application-module-requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ibc-application-module-requirements"}},[e._v("#")]),e._v(" IBC application module requirements")]),e._v(" "),a("p",[e._v("What does Ignite CLI do behind the scenes when creating an IBC module? What do you need to implement to upgrade a regular custom application module to an IBC-enabled module?")]),e._v(" "),a("Highlightbox",{attrs:{type:"info"}},[a("p",[e._v("The steps required to implement IBC can be found in the "),a("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/apps.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("IBC go docs"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[a("strong",[e._v("To have your module interact over IBC you must:")])]),e._v(" "),a("ul",[a("li",[e._v("Implement the "),a("code",[e._v("IBCModule")]),e._v(" interface, i.e.:\n"),a("ul",[a("li",[e._v("channel (opening) handshake callbacks")]),e._v(" "),a("li",[e._v("channel closing handshake callbacks")]),e._v(" "),a("li",[e._v("packet callbacks")])])]),e._v(" "),a("li",[e._v("Bind to one or more ports")]),e._v(" "),a("li",[e._v("Add keeper methods")]),e._v(" "),a("li",[e._v("Define your own packet data and acknowledgement structs as well as how to encode/decode them")]),e._v(" "),a("li",[e._v("Add a route to the IBC router")])])]),e._v(" "),a("p",[e._v("Now take a look at the "),a("em",[e._v("git diff")]),e._v(" and see if you are able to recognize the steps listed above.")]),e._v(" "),a("h3",{attrs:{id:"implementing-the-ibcmodule-interface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementing-the-ibcmodule-interface"}},[e._v("#")]),e._v(" Implementing the "),a("code",[e._v("IBCModule")]),e._v(" interface")]),e._v(" "),a("Highlightbox",{attrs:{type:"note"}},[a("p",[e._v("For a full explanation, visit the "),a("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/ibcmodule.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("IBC go docs"),a("OutboundLink")],1),e._v(".")])]),e._v(" "),a("p",[e._v("The Cosmos SDK expects all IBC modules to implement the "),a("a",{attrs:{href:"https://github.com/cosmos/ibc-go/tree/main/modules/core/05-port/types/module.go",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("IBCModule")]),e._v("\ninterface"),a("OutboundLink")],1),e._v(". This interface contains all of the callbacks IBC expects modules to implement. This includes callbacks related to:")]),e._v(" "),a("ul",[a("li",[e._v("Channel handshake ("),a("code",[e._v("OnChanOpenInit")]),e._v(", "),a("code",[e._v("OnChanOpenTry")]),e._v(", "),a("code",[e._v("OncChanOpenAck")]),e._v(", "),a("code",[e._v("OnChanOpenConfirm")]),e._v(")")]),e._v(" "),a("li",[e._v("Channel closing ("),a("code",[e._v("OnChanCloseInit")]),e._v(", "),a("code",[e._v("OnChanCloseConfirm")]),e._v(")")]),e._v(" "),a("li",[e._v("Packets ("),a("code",[e._v("OnRecvPacket")]),e._v(", "),a("code",[e._v("OnAcknowledgementPacket")]),e._v(", "),a("code",[e._v("OnTimeoutPacket")]),e._v(").")])]),e._v(" "),a("p",[e._v("Ignite CLI implements this in the file "),a("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(".")]),e._v(" "),a("p",[e._v("//TODO: add collapsible window??")]),e._v(" "),a("p",[e._v("Additionally, in the "),a("code",[e._v("module.go")]),e._v(" file, add the following line (and the corresponding import):")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"dmFyICgKICAgIF8gbW9kdWxlLkFwcE1vZHVsZSAgICAgID0gQXBwTW9kdWxle30KICAgIF8gbW9kdWxlLkFwcE1vZHVsZUJhc2ljID0gQXBwTW9kdWxlQmFzaWN7fQogICAgLy8gQWRkIHRoaXMgbGluZQorICAgIF8gcG9ydHR5cGVzLklCQ01vZHVsZSAgID0gSUJDTW9kdWxle30KKQo="}}),e._v(" "),a("h4",{attrs:{id:"channel-handshake-version-negotiation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#channel-handshake-version-negotiation"}},[e._v("#")]),e._v(" Channel handshake version negotiation")]),e._v(" "),a("p",[e._v("Application modules are expected to verify versioning used during the channel handshake procedure.")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("OnChanOpenInit")]),e._v(" will verify that the relayer-chosen parameters are valid and perform any custom "),a("code",[e._v("INIT")]),e._v(" logic. It may return an error if the chosen parameters are invalid, in which case the handshake is aborted. If the provided version string is non-empty, "),a("code",[e._v("OnChanOpenInit")]),e._v(" should return the version string if valid or an error if the provided version is invalid. "),a("strong",[e._v("If the version string is empty, "),a("code",[e._v("OnChanOpenInit")]),e._v(" is expected to return a default version string representing the version(s) it supports.")]),e._v(" If there is no default version string for the application, it should return an error if the provided version is an empty string.")]),e._v(" "),a("li",[a("code",[e._v("OnChanOpenTry")]),e._v(" will verify the relayer-chosen parameters along with the counterparty-chosen version string and perform custom "),a("code",[e._v("TRY")]),e._v(" logic. If the relayer-chosen parameters are invalid, the callback must return an error to abort the handshake. If the counterparty-chosen version is not compatible with this module's supported versions, the callback must return an error to abort the handshake. If the versions are compatible, the try callback must select the final version string and return it to core IBC. "),a("code",[e._v("OnChanOpenTry")]),e._v(" may also perform custom initialization logic.")]),e._v(" "),a("li",[a("code",[e._v("OnChanOpenAck")]),e._v(" will error if the counterparty selected version string is invalid and abort the handshake. It may also perform custom ACK logic.")])]),e._v(" "),a("h4",{attrs:{id:"packet-callbacks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#packet-callbacks"}},[e._v("#")]),e._v(" Packet callbacks")]),e._v(" "),a("p",[e._v("The general application packet flow was discussed in "),a("a",{attrs:{href:"https://tutorials.cosmos.network/academy/4-ibc/channels.html#application-packet-flow",target:"_blank",rel:"noopener noreferrer"}},[e._v("a previous section"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("As a refresher, take a look at this diagram:")]),e._v(" "),a("p",[a("tm-image",{attrs:{src:"./images/packetflow.png"}})],1),e._v(" "),a("p",[e._v("You can now identify packet callbacks in the packet flow by investigating the "),a("code",[e._v("IBCModule")]),e._v(" interface.")]),e._v(" "),a("h5",{attrs:{id:"sending-packets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sending-packets"}},[e._v("#")]),e._v(" Sending packets")]),e._v(" "),a("p",[e._v("Modules "),a("strong",[e._v("do not send packets through callbacks")]),e._v(", since the modules initiate the action of sending packets to the IBC module (as opposed to other parts of the packet flow, where messages sent to the IBC module must trigger execution on the port-bound module through the use of callbacks). Thus, to send a packet a module simply needs to call "),a("code",[e._v("SendPacket")]),e._v(" on the "),a("code",[e._v("IBCChannelKeeper")]),e._v(".")]),e._v(" "),a("HighlightBox",{attrs:{type:"warn"}},[a("p",[e._v("In order to prevent modules from sending packets on channels they do not own, IBC expects modules to pass in the correct channel capability for the packet's source channel.")])]),e._v(" "),a("h5",{attrs:{id:"receiving-packets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#receiving-packets"}},[e._v("#")]),e._v(" Receiving packets")]),e._v(" "),a("p",[e._v("To handle receiving packets, the module must implement the "),a("code",[e._v("OnRecvPacket")]),e._v(" callback. This gets invoked by the IBC module after a packet has been proved valid and correctly processed by the IBC keepers. Thus, the "),a("code",[e._v("OnRecvPacket")]),e._v(" callback only needs to worry about making the appropriate state changes given the packet data, without worrying about whether the packet is valid or not.")]),e._v(" "),a("p",[e._v("Modules may return to the IBC handler an acknowledgement which implements the "),a("code",[e._v("Acknowledgement")]),e._v(" interface. The IBC handler will then commit this acknowledgement of the packet, so that a relayer may relay the acknowledgement back to the sender module.")]),e._v(" "),a("p",[e._v("The state changes that occurred during this callback will only be written if:")]),e._v(" "),a("ul",[a("li",[e._v("The acknowledgement was successful, as indicated by the "),a("code",[e._v("Success()")]),e._v(" function of the acknowledgement.")]),e._v(" "),a("li",[e._v("The acknowledgement returned is nil, indicating that an asynchronous process is occurring.")])]),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Applications which process asynchronous acknowledgements must handle reverting state changes when appropriate. Any state changes that occurred during the "),a("code",[e._v("OnRecvPacket")]),e._v(" callback will be written for asynchronous acknowledgements.")])]),e._v(" "),a("p",[e._v("In "),a("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(" scaffolded by Ignite CLI we find "),a("code",[e._v("OnRecvPacket")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25SZWN2UGFja2V0IGltcGxlbWVudHMgdGhlIElCQ01vZHVsZSBpbnRlcmZhY2UKZnVuYyAoYW0gQXBwTW9kdWxlKSBPblJlY3ZQYWNrZXQoCgljdHggc2RrLkNvbnRleHQsCgltb2R1bGVQYWNrZXQgY2hhbm5lbHR5cGVzLlBhY2tldCwKCXJlbGF5ZXIgc2RrLkFjY0FkZHJlc3MsCikgaWJjZXhwb3J0ZWQuQWNrbm93bGVkZ2VtZW50IHsKCXZhciBhY2sgY2hhbm5lbHR5cGVzLkFja25vd2xlZGdlbWVudAoKCS8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgb3JhY2xlL3BhY2tldC9tb2R1bGUvcmVjdgoKCXZhciBtb2R1bGVQYWNrZXREYXRhIHR5cGVzLkxlYWRlcmJvYXJkUGFja2V0RGF0YQoJLi4uCgoJLy8gRGlzcGF0Y2ggcGFja2V0Cglzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSB7CgkvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9wYWNrZXQvbW9kdWxlL3JlY3YKCWRlZmF1bHQ6CgkJZXJyTXNnIDo9IGZtdC5TcHJpbnRmKCZxdW90O3VucmVjb2duaXplZCAlcyBwYWNrZXQgdHlwZTogJVQmcXVvdDssIHR5cGVzLk1vZHVsZU5hbWUsIHBhY2tldCkKCQlyZXR1cm4gY2hhbm5lbHR5cGVzLk5ld0Vycm9yQWNrbm93bGVkZ2VtZW50KGVyck1zZykKCX0KCgkvLyBOT1RFOiBhY2tub3dsZWRnZW1lbnQgd2lsbCBiZSB3cml0dGVuIHN5bmNocm9ub3VzbHkgZHVyaW5nIElCQyBoYW5kbGVyIGV4ZWN1dGlvbi4KCXJldHVybiBhY2sKfQo="}}),e._v(" "),a("p",[e._v("The "),a("em",[e._v("dispatch packet")]),e._v(" switch statement is added by Ignite CLI. As is stated in the docs, strictly speaking you only need to decode the packet data (discussed in a next section) and return the acknowledgement after processing the packet. However, the structure provided by Ignite CLI is useful for getting set up, and can be changed according to the preference of the developer.")]),e._v(" "),a("p",[e._v("As a reminder, the "),a("code",[e._v("Acknowledgement")]),e._v(" interface:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQWNrbm93bGVkZ2VtZW50IGRlZmluZXMgdGhlIGludGVyZmFjZSB1c2VkIHRvIHJldHVybgovLyBhY2tub3dsZWRnZW1lbnRzIGluIHRoZSBPblJlY3ZQYWNrZXQgY2FsbGJhY2suCnR5cGUgQWNrbm93bGVkZ2VtZW50IGludGVyZmFjZSB7CglTdWNjZXNzKCkgYm9vbAoJQWNrbm93bGVkZ2VtZW50KCkgW11ieXRlCn0K"}}),e._v(" "),a("h5",{attrs:{id:"acknowledging-packets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acknowledging-packets"}},[e._v("#")]),e._v(" Acknowledging packets")]),e._v(" "),a("p",[e._v("The last step of the packet flow depends on whether you have a happy path when the packet has been successfully relayed, or a timeout when something went wrong.")]),e._v(" "),a("p",[e._v("After a module writes an acknowledgement, a relayer can relay back the acknowledgement to the sender module. The sender module can then process the acknowledgement using the "),a("code",[e._v("OnAcknowledgementPacket")]),e._v(" callback. The contents of the acknowledgement are entirely up to the modules on the channel (just like the packet data); however, they may often contain information on whether the packet was successfully processed, along with some additional data that could be useful for remediation if the packet processing failed.")]),e._v(" "),a("p",[e._v("Since the modules are responsible for agreeing on an encoding/decoding standard for packet data and acknowledgements, IBC will pass in the acknowledgements as "),a("code",[e._v("[]byte")]),e._v(" to this callback. The callback is responsible for decoding the acknowledgement and processing it.")]),e._v(" "),a("p",[e._v("In "),a("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(" scaffolded by Ignite CLI we find "),a("code",[e._v("OnAcknowledgementPacket")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25BY2tub3dsZWRnZW1lbnRQYWNrZXQgaW1wbGVtZW50cyB0aGUgSUJDTW9kdWxlIGludGVyZmFjZQpmdW5jIChhbSBBcHBNb2R1bGUpIE9uQWNrbm93bGVkZ2VtZW50UGFja2V0KAoJY3R4IHNkay5Db250ZXh0LAoJbW9kdWxlUGFja2V0IGNoYW5uZWx0eXBlcy5QYWNrZXQsCglhY2tub3dsZWRnZW1lbnQgW11ieXRlLAoJcmVsYXllciBzZGsuQWNjQWRkcmVzcywKKSBlcnJvciB7Cgl2YXIgYWNrIGNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnQKCS4uLiAvL3ZhbGlkYXRpb24KCgkvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIG9yYWNsZS9wYWNrZXQvbW9kdWxlL2FjawoKCXZhciBtb2R1bGVQYWNrZXREYXRhIHR5cGVzLkxlYWRlcmJvYXJkUGFja2V0RGF0YQoJLi4uIC8vdmFsaWRhdGlvbgoKCXZhciBldmVudFR5cGUgc3RyaW5nCgoJLy8gRGlzcGF0Y2ggcGFja2V0Cglzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSB7CgkvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9wYWNrZXQvbW9kdWxlL2FjawoJZGVmYXVsdDoKCQkuLi4gLy9lcnJNc2cKCX0KCgljdHguRXZlbnRNYW5hZ2VyKCkuRW1pdEV2ZW50KAoJCXNkay5OZXdFdmVudCgKCQkJLi4uCgkJKSwKCSkKCglzd2l0Y2ggcmVzcCA6PSBhY2suUmVzcG9uc2UuKHR5cGUpIHsKCWNhc2UgKmNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnRfUmVzdWx0OgoJCWN0eC5FdmVudE1hbmFnZXIoKS5FbWl0RXZlbnQoCgkJCXNkay5OZXdFdmVudCgKCQkJCS4uLgoJCQkpLAoJCSkKCWNhc2UgKmNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnRfRXJyb3I6CgkJY3R4LkV2ZW50TWFuYWdlcigpLkVtaXRFdmVudCgKCQkJc2RrLk5ld0V2ZW50KAoJCQkJLi4uCgkJCSksCgkJKQoJfQoKCXJldHVybiBuaWwKfQo="}}),e._v(" "),a("p",[e._v("Again, the structure to dispatch the packet with the switch statement, as well as the switch statement for the ack (success case or error case), have been structured by Ignite CLI where the "),a("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/ibcmodule.html#acknowledging-packets",target:"_blank",rel:"noopener noreferrer"}},[e._v("docs"),a("OutboundLink")],1),e._v(" offer more freedom to the developer to implement decoding and processing of the ack.")]),e._v(" "),a("Highlightbox",{attrs:{type:"info"}},[a("p",[e._v("The events that are being emitted are defined in "),a("code",[e._v("x/leaderboard/types/events_ibc.go")]),e._v(".")])]),e._v(" "),a("h5",{attrs:{id:"timing-out-packets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timing-out-packets"}},[e._v("#")]),e._v(" Timing out packets")]),e._v(" "),a("p",[e._v("If the timeout for a packet is reached before the packet is successfully received, or the counterparty channel end is closed before the packet is successfully received, then the receiving chain can no longer process it. Thus the sending chain must process the timeout using "),a("code",[e._v("OnTimeoutPacket")]),e._v(" to handle this situation.")]),e._v(" "),a("p",[e._v("Again, the IBC module will verify that the timeout is indeed valid, so our module only needs to implement the state machine logic for what to do once a timeout is reached and the packet can no longer be received.")]),e._v(" "),a("p",[e._v("In "),a("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(" scaffolded by Ignite CLI we find "),a("code",[e._v("OnAcknowledgementPacket")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25UaW1lb3V0UGFja2V0IGltcGxlbWVudHMgdGhlIElCQ01vZHVsZSBpbnRlcmZhY2UKZnVuYyAoYW0gQXBwTW9kdWxlKSBPblRpbWVvdXRQYWNrZXQoCgljdHggc2RrLkNvbnRleHQsCgltb2R1bGVQYWNrZXQgY2hhbm5lbHR5cGVzLlBhY2tldCwKCXJlbGF5ZXIgc2RrLkFjY0FkZHJlc3MsCikgZXJyb3IgewoJdmFyIG1vZHVsZVBhY2tldERhdGEgdHlwZXMuTGVhZGVyYm9hcmRQYWNrZXREYXRhCgkuLi4gLy8gdmFsaWRhdGlvbgoKCS8vIERpc3BhdGNoIHBhY2tldAoJc3dpdGNoIHBhY2tldCA6PSBtb2R1bGVQYWNrZXREYXRhLlBhY2tldC4odHlwZSkgewoJLy8gdGhpcyBsaW5lIGlzIHVzZWQgYnkgc3RhcnBvcnQgc2NhZmZvbGRpbmcgIyBpYmMvcGFja2V0L21vZHVsZS90aW1lb3V0CglkZWZhdWx0OgoJCS4uLiAvLyBlcnJNc2cKCX0KCglyZXR1cm4gbmlsCn0K"}}),e._v(" "),a("h4",{attrs:{id:"binding-to-a-port"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#binding-to-a-port"}},[e._v("#")]),e._v(" Binding to a port")]),e._v(" "),a("p",[e._v("Every IBC module binds to a port, with a unique "),a("code",[e._v("portID")]),e._v(" which denotes the type of application.")]),e._v(" "),a("Highlightbox",{attrs:{type:"note"}},[a("p",[e._v("Note that "),a("code",[e._v("portID")]),e._v(" does not refer to a specific numerical ID, like "),a("code",[e._v("localhost:8080")]),e._v(" with a "),a("code",[e._v("portID")]),e._v(" 8080. Rather it refers to the application module the port binds. For IBC Modules built with the Cosmos SDK, it defaults to the module's name, and for Cosmwasm contracts it defaults to the contract address.")])]),e._v(" "),a("p",[e._v("Currently, ports must be bound on app initialization. In order to bind modules to their respective ports on initialization, implement the following:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Add port ID to the "),a("code",[e._v("GenesisState")]),e._v(" proto definition:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIEBAIHByb3RvL2xlYWRlcmJvYXJkL2dlbmVzaXMucHJvdG8KICAgIC8vIEdlbmVzaXNTdGF0ZSBkZWZpbmVzIHRoZSBsZWFkZXJib2FyZCBtb2R1bGUncyBnZW5lc2lzIHN0YXRlLgogICAgbWVzc2FnZSBHZW5lc2lzU3RhdGUgewogICAgICAgIFBhcmFtcyBwYXJhbXMgPSAxIFsoZ29nb3Byb3RvLm51bGxhYmxlKSA9IGZhbHNlXTsKKyAgICAgICBzdHJpbmcgcG9ydF9pZCA9IDI7CiAgICAgICAgLy8gdGhpcyBsaW5lIGlzIHVzZWQgYnkgc3RhcnBvcnQgc2NhZmZvbGRpbmcgIyBnZW5lc2lzL3Byb3RvL3N0YXRlCn0K"}})],1),e._v(" "),a("li",[a("p",[e._v("Add port ID as a key to the module store in "),a("code",[e._v("x/leaderboard/types/keys.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIEBAIGNvbnN0IGluIHgvbGVhZGVyYm9hcmQvdHlwZXMuZ28KICAgIC8vIE1lbVN0b3JlS2V5IGRlZmluZXMgdGhlIGluLW1lbW9yeSBzdG9yZSBrZXkKICAgIE1lbVN0b3JlS2V5ID0gJnF1b3Q7bWVtX2xlYWRlcmJvYXJkJnF1b3Q7CgorICAgIC8vIFZlcnNpb24gZGVmaW5lcyB0aGUgY3VycmVudCB2ZXJzaW9uIHRoZSBJQkMgbW9kdWxlIHN1cHBvcnRzCisgICAgVmVyc2lvbiA9ICZxdW90O2xlYWRlcmJvYXJkLTEmcXVvdDsKCisgICAgLy8gUG9ydElEIGlzIHRoZSBkZWZhdWx0IHBvcnQgaWQgdGhhdCBtb2R1bGUgYmluZHMgdG8KKyAgICBQb3J0SUQgPSAmcXVvdDtsZWFkZXJib2FyZCZxdW90OworICAgICkKCisgICAgdmFyICgKKyAgICAgICAgLy8gUG9ydEtleSBkZWZpbmVzIHRoZSBrZXkgdG8gc3RvcmUgdGhlIHBvcnQgSUQgaW4gc3RvcmUKKyAgICAgICAgUG9ydEtleSA9IEtleVByZWZpeCgmcXVvdDtsZWFkZXJib2FyZC1wb3J0LSZxdW90OykKICAgICkK"}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("By default the portID is set to the module name, and the application version is set to "),a("code",[e._v("<modulename>-n")]),e._v(", where "),a("code",[e._v("n")]),e._v(" is an incrementing value.")])])],1),e._v(" "),a("li",[a("p",[e._v("Add port ID to "),a("code",[e._v("x/leaderboard/types/genesis.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIC8vIERlZmF1bHRHZW5lc2lzU3RhdGUgcmV0dXJucyBhIEdlbmVzaXNTdGF0ZSB3aXRoICZxdW90O3RyYW5zZmVyJnF1b3Q7IGFzIHRoZSBkZWZhdWx0IFBvcnRJRC4KICAgIGZ1bmMgRGVmYXVsdEdlbmVzaXNTdGF0ZSgpICpHZW5lc2lzU3RhdGUgewogICAgICAgIHJldHVybiAmYW1wO0dlbmVzaXNTdGF0ZXsKKyAgICAgICAgICAgIFBvcnRJZDogICAgICBQb3J0SUQsCiAgICAgICAgICAgIC8vIGFkZGl0aW9uYWwgay12IGZpZWxkcwogICAgICAgIH0KICAgIH0KCiAgICAvLyBWYWxpZGF0ZSBwZXJmb3JtcyBiYXNpYyBnZW5lc2lzIHN0YXRlIHZhbGlkYXRpb24gcmV0dXJuaW5nIGFuIGVycm9yIHVwb24gYW55CiAgICAvLyBmYWlsdXJlLgogICAgZnVuYyAoZ3MgR2VuZXNpc1N0YXRlKSBWYWxpZGF0ZSgpIGVycm9yIHsKKyAgICAgICBpZiBlcnIgOj0gaG9zdC5Qb3J0SWRlbnRpZmllclZhbGlkYXRvcihncy5Qb3J0SWQpOyBlcnIgIT0gbmlsIHsKKyAgICAgICAgICAgIHJldHVybiBlcnIKKyAgICAgICAgfQogICAgICAgIC8vYWRkdGlvbmFsIHZhbGlkYXRpb25zCgogICAgICAgIHJldHVybiBncy5QYXJhbXMuVmFsaWRhdGUoKQogICAgfQo="}})],1),e._v(" "),a("li",[a("p",[e._v("Bind the IBC module to the port in "),a("code",[e._v("x/leaderboard/genesis.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIEBAIEluaXRHZW5lc2lzCiAgICBmdW5jIEluaXRHZW5lc2lzKGN0eCBzZGsuQ29udGV4dCwgayBrZWVwZXIuS2VlcGVyLCBnZW5TdGF0ZSB0eXBlcy5HZW5lc2lzU3RhdGUpIHsKICAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGdlbmVzaXMvbW9kdWxlL2luaXQKKyAgICAgICBrLlNldFBvcnQoY3R4LCBnZW5TdGF0ZS5Qb3J0SWQpCisgICAgICAgLy8gT25seSB0cnkgdG8gYmluZCB0byBwb3J0IGlmIGl0IGlzIG5vdCBhbHJlYWR5IGJvdW5kLCBzaW5jZSB3ZSBtYXkgYWxyZWFkeSBvd24KKyAgICAgICAvLyBwb3J0IGNhcGFiaWxpdHkgZnJvbSBjYXBhYmlsaXR5IEluaXRHZW5lc2lzCisgICAgICAgaWYgIWsuSXNCb3VuZChjdHgsIGdlblN0YXRlLlBvcnRJZCkgeworICAgICAgICAgICAvLyBtb2R1bGUgYmluZHMgdG8gdGhlIHBvcnQgb24gSW5pdENoYWluCisgICAgICAgICAgIC8vIGFuZCBjbGFpbXMgdGhlIHJldHVybmVkIGNhcGFiaWxpdHkKKyAgICAgICAgICAgZXJyIDo9IGsuQmluZFBvcnQoY3R4LCBnZW5TdGF0ZS5Qb3J0SWQpCisgICAgICAgICAgIGlmIGVyciAhPSBuaWwgeworICAgICAgICAgICAgICAgcGFuaWMoJnF1b3Q7Y291bGQgbm90IGNsYWltIHBvcnQgY2FwYWJpbGl0eTogJnF1b3Q7ICsgZXJyLkVycm9yKCkpCisgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgay5TZXRQYXJhbXMoY3R4LCBnZW5TdGF0ZS5QYXJhbXMpCiAgICB9CgogICAgQEAgRXhwb3J0R2VuZXNpcwogICAgZnVuYyBFeHBvcnRHZW5lc2lzKGN0eCBzZGsuQ29udGV4dCwgayBrZWVwZXIuS2VlcGVyKSAqdHlwZXMuR2VuZXNpc1N0YXRlIHsKICAgICAgICBnZW5lc2lzIDo9IHR5cGVzLkRlZmF1bHRHZW5lc2lzKCkKICAgICAgICBnZW5lc2lzLlBhcmFtcyA9IGsuR2V0UGFyYW1zKGN0eCkKCisgICAgICAgIGdlbmVzaXMuUG9ydElkID0gay5HZXRQb3J0KGN0eCkKICAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGdlbmVzaXMvbW9kdWxlL2V4cG9ydAoKICAgICAgICByZXR1cm4gZ2VuZXNpcwogICAgfQo="}}),e._v(" "),a("p",[e._v("Where:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gSXNCb3VuZCBjaGVja3MgaWYgdGhlICBtb2R1bGUgaXMgYWxyZWFkeSBib3VuZCB0byB0aGUgZGVzaXJlZCBwb3J0CmZ1bmMgKGsgS2VlcGVyKSBJc0JvdW5kKGN0eCBzZGsuQ29udGV4dCwgcG9ydElEIHN0cmluZykgYm9vbCB7CiAgICBfLCBvayA6PSBrLnNjb3BlZEtlZXBlci5HZXRDYXBhYmlsaXR5KGN0eCwgaG9zdC5Qb3J0UGF0aChwb3J0SUQpKQogICAgcmV0dXJuIG9rCn0KCi8vIEJpbmRQb3J0IGRlZmluZXMgYSB3cmFwcGVyIGZ1bmN0aW9uIGZvciB0aGUgcG9ydCBLZWVwZXIncyBmdW5jdGlvbiBpbgovLyBvcmRlciB0byBleHBvc2UgaXQgdG8gbW9kdWxlJ3MgSW5pdEdlbmVzaXMgZnVuY3Rpb24KZnVuYyAoayBLZWVwZXIpIEJpbmRQb3J0KGN0eCBzZGsuQ29udGV4dCwgcG9ydElEIHN0cmluZykgZXJyb3IgewogICAgY2FwIDo9IGsucG9ydEtlZXBlci5CaW5kUG9ydChjdHgsIHBvcnRJRCkKICAgIHJldHVybiBrLkNsYWltQ2FwYWJpbGl0eShjdHgsIGNhcCwgaG9zdC5Qb3J0UGF0aChwb3J0SUQpKQp9Cg=="}}),e._v(" "),a("p",[e._v("The module binds to the desired port(s) and returns the capabilities.")])],1)]),e._v(" "),a("h4",{attrs:{id:"keeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keeper"}},[e._v("#")]),e._v(" Keeper")]),e._v(" "),a("p",[e._v("Previous steps at some points referenced keeper methods that deal with binding to a port or getting and setting a port, claiming and authenticating capabilities. These methods need to be added to the keeper.")]),e._v(" "),a("p",[e._v("For a full overview, check out the "),a("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/keeper.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("IBC go docs"),a("OutboundLink")],1),e._v(" and compare with the "),a("code",[e._v("x/leaderboard/keeper/keeper.go")]),e._v(" file.")]),e._v(" "),a("p",[e._v("You will notice that Ignite CLI uses a custom "),a("code",[e._v("cosmosibckeeper")]),e._v(" package you can find "),a("a",{attrs:{href:"https://github.com/ignite/cli/tree/develop/ignite/pkg/cosmosibckeeper",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"routing-and-app-go"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#routing-and-app-go"}},[e._v("#")]),e._v(" Routing and app.go")]),e._v(" "),a("p",[e._v("When looking at "),a("code",[e._v("app.go")]),e._v(" we see some minor additions, the most prominent of which is adding a route to the "),a("code",[e._v("Leaderboard")]),e._v(" module on the "),a("code",[e._v("IBC Router")]),e._v(".")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIEBAIGZ1bmMgTmV3IGluIGFwcC9hcHAuZ28KICAgIGliY1JvdXRlciA6PSBpYmNwb3J0dHlwZXMuTmV3Um91dGVyKCkKCWliY1JvdXRlci5BZGRSb3V0ZShpYmN0cmFuc2ZlcnR5cGVzLk1vZHVsZU5hbWUsIHRyYW5zZmVySUJDTW9kdWxlKQoJaWJjUm91dGVyLkFkZFJvdXRlKG1vbml0b3JpbmdwdHlwZXMuTW9kdWxlTmFtZSwgbW9uaXRvcmluZ01vZHVsZSkKKwlpYmNSb3V0ZXIuQWRkUm91dGUobGVhZGVyYm9hcmRtb2R1bGV0eXBlcy5Nb2R1bGVOYW1lLCBsZWFkZXJib2FyZE1vZHVsZSkKCS8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgaWJjL2FwcC9yb3V0ZXIKCWFwcC5JQkNLZWVwZXIuU2V0Um91dGVyKGliY1JvdXRlcikK"}}),e._v(" "),a("h4",{attrs:{id:"next-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[e._v("#")]),e._v(" Next up")]),e._v(" "),a("p",[e._v("The step we skipped until now is to define the packet and acknowledgement data. In the next section we will first scaffold the packet with Ignite CLI and then again compare the additions with a git diff.")])],1)}),[],!1,null,null,null);t.default=l.exports}}]);