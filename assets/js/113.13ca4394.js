(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{727:function(e,a,t){"use strict";t.r(a);var c=t(1),l=Object(c.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"adding-packet-and-acknowledgement-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adding-packet-and-acknowledgement-data"}},[e._v("#")]),e._v(" Adding Packet and Acknowledgement data")]),e._v(" "),t("p",[e._v("It's time to learn how to define packets and acks (acknowledgements) for the Leaderboard blockchain. Remember that this blockchain will mostly be receiving packets from the checkers blockchain or other gaming chains. This will be handled in the checkers blockchain extension tutorial.")]),e._v(" "),t("p",[e._v("In this section you will add an additional packet definition that will enable the Leaderboard chain to send a packet to connected game chains when a player has entered the top of the rankings.")]),e._v(" "),t("p",[e._v("The documentation on how to define packets and acks in IBC can be found in "),t("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/packets_acks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("the IBC go docs"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"scaffold-a-packet-with-ignite-cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scaffold-a-packet-with-ignite-cli"}},[e._v("#")]),e._v(" Scaffold a packet with Ignite CLI")]),e._v(" "),t("p",[e._v("Scaffold the IBC packet data with Ignite CLI and compare once more with "),t("em",[e._v("git diff")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"aWduaXRlIHNjYWZmb2xkIHBhY2tldCBpYmNUb3BSYW5rIHBsYXllcklkIHJhbmsgc2NvcmUgLS1hY2sgcGxheWVySWQgLS1tb2R1bGUgbGVhZGVyYm9hcmQK"}}),e._v(" "),t("p",[e._v("Note that the packet is called "),t("code",[e._v("ibcTopRank")]),e._v(", which includes the fields "),t("code",[e._v("playerId")]),e._v(", "),t("code",[e._v("rank")]),e._v(", and "),t("code",[e._v("score")]),e._v(". Additionally, you will send back the "),t("code",[e._v("playerId")]),e._v(" of a player who enters the top of the rankings through the "),t("code",[e._v("Acknowledgement")]),e._v(".")]),e._v(" "),t("p",[e._v("The output on the terminal gives an overview of the changes made:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"bW9kaWZ5IHByb3RvL2xlYWRlcmJvYXJkL3BhY2tldC5wcm90bwptb2RpZnkgcHJvdG8vbGVhZGVyYm9hcmQvdHgucHJvdG8KbW9kaWZ5IHgvbGVhZGVyYm9hcmQvY2xpZW50L2NsaS90eC5nbwpjcmVhdGUgeC9sZWFkZXJib2FyZC9jbGllbnQvY2xpL3R4X2liY190b3BfcmFuay5nbwptb2RpZnkgeC9sZWFkZXJib2FyZC9oYW5kbGVyLmdvCmNyZWF0ZSB4L2xlYWRlcmJvYXJkL2tlZXBlci9pYmNfdG9wX3JhbmsuZ28KY3JlYXRlIHgvbGVhZGVyYm9hcmQva2VlcGVyL21zZ19zZXJ2ZXJfaWJjX3RvcF9yYW5rLmdvCm1vZGlmeSB4L2xlYWRlcmJvYXJkL21vZHVsZV9pYmMuZ28KbW9kaWZ5IHgvbGVhZGVyYm9hcmQvdHlwZXMvY29kZWMuZ28KbW9kaWZ5IHgvbGVhZGVyYm9hcmQvdHlwZXMvZXZlbnRzX2liYy5nbwpjcmVhdGUgeC9sZWFkZXJib2FyZC90eXBlcy9tZXNzYWdlc19pYmNfdG9wX3JhbmsuZ28KY3JlYXRlIHgvbGVhZGVyYm9hcmQvdHlwZXMvbWVzc2FnZXNfaWJjX3RvcF9yYW5rX3Rlc3QuZ28KY3JlYXRlIHgvbGVhZGVyYm9hcmQvdHlwZXMvcGFja2V0X2liY190b3BfcmFuay5nbwoK8J+OiSBDcmVhdGVkIGEgcGFja2V0IGBpYmNUb3BSYW5rYC4K"}}),e._v(" "),t("p",[e._v("Next you will investigate each of the most important additions to the code.")]),e._v(" "),t("h2",{attrs:{id:"proto-definitions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#proto-definitions"}},[e._v("#")]),e._v(" Proto definitions")]),e._v(" "),t("p",[e._v("The first additions are to the proto definitions in the "),t("code",[e._v("packet.proto")]),e._v(" and "),t("code",[e._v("tx.proto")]),e._v(" files:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"QEAgbWVzc2FnZSBMZWFkZXJib2FyZFBhY2tldERhdGEgewogICAgb25lb2YgcGFja2V0IHsKICAgICAgICBOb0RhdGEgbm9EYXRhID0gMTsKICAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9wYWNrZXQvcHJvdG8vZmllbGQKKwkJSWJjVG9wUmFua1BhY2tldERhdGEgaWJjVG9wUmFua1BhY2tldCA9IDI7IAogICAgICAgIC8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgaWJjL3BhY2tldC9wcm90by9maWVsZC9udW1iZXIKICAgIH0KfQo="}}),e._v(" "),t("p",[e._v("With "),t("code",[e._v("IbcTopRankPacketData")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"Ly8gSWJjVG9wUmFua1BhY2tldERhdGEgZGVmaW5lcyBhIHN0cnVjdCBmb3IgdGhlIHBhY2tldCBwYXlsb2FkCm1lc3NhZ2UgSWJjVG9wUmFua1BhY2tldERhdGEgewogIHN0cmluZyBwbGF5ZXJJZCA9IDE7CiAgc3RyaW5nIHJhbmsgPSAyOwogIHN0cmluZyBzY29yZSA9IDM7Cn0K"}}),e._v(" "),t("p",[e._v("And the ack:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"Ly8gSWJjVG9wUmFua1BhY2tldEFjayBkZWZpbmVzIGEgc3RydWN0IGZvciB0aGUgcGFja2V0IGFja25vd2xlZGdtZW50Cm1lc3NhZ2UgSWJjVG9wUmFua1BhY2tldEFjayB7CgkgIHN0cmluZyBwbGF5ZXJJZCA9IDE7Cn0K"}}),e._v(" "),t("p",[e._v("In "),t("code",[e._v("tx.proto")]),e._v(" a Message service is added:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"Ly8gTXNnIGRlZmluZXMgdGhlIE1zZyBzZXJ2aWNlLgpzZXJ2aWNlIE1zZyB7CisgICBycGMgU2VuZEliY1RvcFJhbmsoTXNnU2VuZEliY1RvcFJhbmspIHJldHVybnMgKE1zZ1NlbmRJYmNUb3BSYW5rUmVzcG9uc2UpOwogICAgLy8gdGhpcyBsaW5lIGlzIHVzZWQgYnkgc3RhcnBvcnQgc2NhZmZvbGRpbmcgIyBwcm90by90eC9ycGMKfQo="}}),e._v(" "),t("p",[e._v("Where:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBNc2dTZW5kSWJjVG9wUmFuayB7CiAgc3RyaW5nIGNyZWF0b3IgPSAxOwogIHN0cmluZyBwb3J0ID0gMjsKICBzdHJpbmcgY2hhbm5lbElEID0gMzsKICB1aW50NjQgdGltZW91dFRpbWVzdGFtcCA9IDQ7CiAgc3RyaW5nIHBsYXllcklkID0gNTsKICBzdHJpbmcgcmFuayA9IDY7CiAgc3RyaW5nIHNjb3JlID0gNzsKfQoKbWVzc2FnZSBNc2dTZW5kSWJjVG9wUmFua1Jlc3BvbnNlIHsKfQo="}}),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("The proto definitions will be compiled into "),t("code",[e._v("types/packet.pb.go")]),e._v(" and "),t("code",[e._v("types/tx.pb.go")]),e._v(".")])]),e._v(" "),t("h2",{attrs:{id:"cli-commands"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-commands"}},[e._v("#")]),e._v(" CLI commands")]),e._v(" "),t("p",[e._v("Ignite CLI also creates CLI commands to send packets, and adds them to the "),t("code",[e._v("client/cli/")]),e._v(" folder.")]),e._v(" "),t("p",[e._v("You can thus send packets from the CLI with the following command:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"bGVhZGVyYm9hcmRkIHR4IGxlYWRlcmJvYXJkIHNlbmQtaWJjVG9wUmFuayBbcG9ydElEXSBbY2hhbm5lbElEXSBbcGxheWVySWRdIFtyYW5rXSBbc2NvcmVdCg=="}}),e._v(" "),t("h2",{attrs:{id:"sendpacket-and-packet-callback-logic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sendpacket-and-packet-callback-logic"}},[e._v("#")]),e._v(" SendPacket and Packet callback logic")]),e._v(" "),t("p",[e._v("When scaffolding an IBC module with Ignite CLI you saw the implementation of the "),t("code",[e._v("IBCModule")]),e._v(" interface, including a barebones packet callbacks structure. Now that you have also scaffolded a packet (and ack), the callbacks have been added with logic to handle the "),t("em",[e._v("receive")]),e._v(", "),t("em",[e._v("ack")]),e._v(", and "),t("em",[e._v("timeout")]),e._v(" scenarios.")]),e._v(" "),t("p",[e._v("Additionally, for the sending of a packet a message server has been added that handles a SendPacket message, in this case "),t("code",[e._v("MsgSendIbcTopRank")]),e._v(".")]),e._v(" "),t("Highlightbox",{attrs:{type:"tip"}},[t("p",[e._v("IBC allows developers some freedom regarding how to implement the custom logic, decoding and encoding packets, and processing acks. The provided structure is just one example of how to do this.")]),e._v(" "),t("p",[e._v("It makes sense to focus on the general flow to handle user messages or IBC callbacks, rather than the specific implementation by Ignite CLI.")])]),e._v(" "),t("h3",{attrs:{id:"sending-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sending-packets"}},[e._v("#")]),e._v(" Sending packets")]),e._v(" "),t("p",[e._v("To handle a user submitting a message to send an IBC packet, a message server is added to the handler:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIEBAIHgvbGVhZGVyYm9hcmQvaGFuZGxlci5nbwogICAgZnVuYyBOZXdIYW5kbGVyKGsga2VlcGVyLktlZXBlcikgc2RrLkhhbmRsZXIgeworICAgICAgICBtc2dTZXJ2ZXIgOj0ga2VlcGVyLk5ld01zZ1NlcnZlckltcGwoaykKCiAgICAgICAgcmV0dXJuIGZ1bmMoY3R4IHNkay5Db250ZXh0LCBtc2cgc2RrLk1zZykgKCpzZGsuUmVzdWx0LCBlcnJvcikgewogICAgICAgICAgICBjdHggPSBjdHguV2l0aEV2ZW50TWFuYWdlcihzZGsuTmV3RXZlbnRNYW5hZ2VyKCkpCgogICAgICAgICAgICBzd2l0Y2ggbXNnIDo9IG1zZy4odHlwZSkgeworICAgICAgICAgICAgY2FzZSAqdHlwZXMuTXNnU2VuZEliY1RvcFJhbms6CisgICAgICAgICAgICAgICByZXMsIGVyciA6PSBtc2dTZXJ2ZXIuU2VuZEliY1RvcFJhbmsoc2RrLldyYXBTREtDb250ZXh0KGN0eCksIG1zZykKKyAgICAgICAgICAgICAgIHJldHVybiBzZGsuV3JhcFNlcnZpY2VSZXN1bHQoY3R4LCByZXMsIGVycikKICAgICAgICAgICAgICAgIC8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgMQogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZXJyTXNnIDo9IGZtdC5TcHJpbnRmKCZxdW90O3VucmVjb2duaXplZCAlcyBtZXNzYWdlIHR5cGU6ICVUJnF1b3Q7LCB0eXBlcy5Nb2R1bGVOYW1lLCBtc2cpCiAgICAgICAgICAgICAgICByZXR1cm4gbmlsLCBzZGtlcnJvcnMuV3JhcChzZGtlcnJvcnMuRXJyVW5rbm93blJlcXVlc3QsIGVyck1zZykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K"}}),e._v(" "),t("p",[e._v("It calls the "),t("code",[e._v("SendIbcTopRank")]),e._v(" method on the message server, defined as:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBtc2dTZXJ2ZXIpIFNlbmRJYmNUb3BSYW5rKGdvQ3R4IGNvbnRleHQuQ29udGV4dCwgbXNnICp0eXBlcy5Nc2dTZW5kSWJjVG9wUmFuaykgKCp0eXBlcy5Nc2dTZW5kSWJjVG9wUmFua1Jlc3BvbnNlLCBlcnJvcikgewoJY3R4IDo9IHNkay5VbndyYXBTREtDb250ZXh0KGdvQ3R4KQoKCS8vIFRPRE86IGxvZ2ljIGJlZm9yZSB0cmFuc21pdHRpbmcgdGhlIHBhY2tldAoKCS8vIENvbnN0cnVjdCB0aGUgcGFja2V0Cgl2YXIgcGFja2V0IHR5cGVzLkliY1RvcFJhbmtQYWNrZXREYXRhCgoJcGFja2V0LlBsYXllcklkID0gbXNnLlBsYXllcklkCglwYWNrZXQuUmFuayA9IG1zZy5SYW5rCglwYWNrZXQuU2NvcmUgPSBtc2cuU2NvcmUKCgkvLyBUcmFuc21pdCB0aGUgcGFja2V0CgllcnIgOj0gay5UcmFuc21pdEliY1RvcFJhbmtQYWNrZXQoCgkJY3R4LAoJCXBhY2tldCwKCQltc2cuUG9ydCwKCQltc2cuQ2hhbm5lbElELAoJCWNsaWVudHR5cGVzLlplcm9IZWlnaHQoKSwKCQltc2cuVGltZW91dFRpbWVzdGFtcCwKCSkKCWlmIGVyciAhPSBuaWwgewoJCXJldHVybiBuaWwsIGVycgoJfQoKCXJldHVybiAmYW1wO3R5cGVzLk1zZ1NlbmRJYmNUb3BSYW5rUmVzcG9uc2V7fSwgbmlsCn0K"}}),e._v(" "),t("p",[e._v("This in turn calls the "),t("code",[e._v("TransmitIbcTopRankPacket")]),e._v(" method on the module's keeper, defined in "),t("code",[e._v("x/leaderboard/keeper/ibc_top_rank.go")]),e._v(". This method gets all of the required metadata from core IBC before sending the packet using the ChannelKeeper's "),t("code",[e._v("SendPacket")]),e._v(" function:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIFRyYW5zbWl0SWJjVG9wUmFua1BhY2tldCgKCWN0eCBzZGsuQ29udGV4dCwKCXBhY2tldERhdGEgdHlwZXMuSWJjVG9wUmFua1BhY2tldERhdGEsCglzb3VyY2VQb3J0LAoJc291cmNlQ2hhbm5lbCBzdHJpbmcsCgl0aW1lb3V0SGVpZ2h0IGNsaWVudHR5cGVzLkhlaWdodCwKCXRpbWVvdXRUaW1lc3RhbXAgdWludDY0LAopIGVycm9yIHsKCglzb3VyY2VDaGFubmVsRW5kLCBmb3VuZCA6PSBrLkNoYW5uZWxLZWVwZXIuR2V0Q2hhbm5lbChjdHgsIHNvdXJjZVBvcnQsIHNvdXJjZUNoYW5uZWwpCgkuLi4gLy8gZXJyb3IgdmFsaWRhdGlvbgoKCWRlc3RpbmF0aW9uUG9ydCA6PSBzb3VyY2VDaGFubmVsRW5kLkdldENvdW50ZXJwYXJ0eSgpLkdldFBvcnRJRCgpCglkZXN0aW5hdGlvbkNoYW5uZWwgOj0gc291cmNlQ2hhbm5lbEVuZC5HZXRDb3VudGVycGFydHkoKS5HZXRDaGFubmVsSUQoKQoKCS8vIGdldCB0aGUgbmV4dCBzZXF1ZW5jZQoJc2VxdWVuY2UsIGZvdW5kIDo9IGsuQ2hhbm5lbEtlZXBlci5HZXROZXh0U2VxdWVuY2VTZW5kKGN0eCwgc291cmNlUG9ydCwgc291cmNlQ2hhbm5lbCkKCS4uLiAvLyBlcnJvciB2YWxpZGF0aW9uCgoJY2hhbm5lbENhcCwgb2sgOj0gay5TY29wZWRLZWVwZXIuR2V0Q2FwYWJpbGl0eShjdHgsIGhvc3QuQ2hhbm5lbENhcGFiaWxpdHlQYXRoKHNvdXJjZVBvcnQsIHNvdXJjZUNoYW5uZWwpKQoJLi4uIC8vIGVycm9yIHZhbGlkYXRpb24KCglwYWNrZXRCeXRlcywgZXJyIDo9IHBhY2tldERhdGEuR2V0Qnl0ZXMoKQoJLi4uIC8vIGVycm9yIHZhbGlkYXRpb24KCglwYWNrZXQgOj0gY2hhbm5lbHR5cGVzLk5ld1BhY2tldCgKCQlwYWNrZXRCeXRlcywKCQlzZXF1ZW5jZSwKCQlzb3VyY2VQb3J0LAoJCXNvdXJjZUNoYW5uZWwsCgkJZGVzdGluYXRpb25Qb3J0LAoJCWRlc3RpbmF0aW9uQ2hhbm5lbCwKCQl0aW1lb3V0SGVpZ2h0LAoJCXRpbWVvdXRUaW1lc3RhbXAsCgkpCgoJaWYgZXJyIDo9IGsuQ2hhbm5lbEtlZXBlci5TZW5kUGFja2V0KGN0eCwgY2hhbm5lbENhcCwgcGFja2V0KTsgZXJyICE9IG5pbCB7CgkJcmV0dXJuIGVycgoJfQoKCXJldHVybiBuaWwKfQo="}}),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("When you want to add additional custom logic before transmitting the packet, you do so in the "),t("code",[e._v("SendIbcTopRank")]),e._v(" method on the message server.")])]),e._v(" "),t("h3",{attrs:{id:"receiving-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#receiving-packets"}},[e._v("#")]),e._v(" Receiving packets")]),e._v(" "),t("p",[e._v("In a previous section we examined the "),t("code",[e._v("OnRecvPacket")]),e._v(" callback in the "),t("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(" file.")]),e._v(" "),t("p",[e._v("There, Ignite CLI had set up a structure to dispatch the packet depending on packet type through a switch statement. Now, by adding the "),t("code",[e._v("IbcTopRank")]),e._v(" packet, a case has been added:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQCBzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSBpbiBPblJlY3ZQYWNrZXQKY2FzZSAqdHlwZXMuTGVhZGVyYm9hcmRQYWNrZXREYXRhX0liY1RvcFJhbmtQYWNrZXQ6CgkJcGFja2V0QWNrLCBlcnIgOj0gYW0ua2VlcGVyLk9uUmVjdkliY1RvcFJhbmtQYWNrZXQoY3R4LCBtb2R1bGVQYWNrZXQsICpwYWNrZXQuSWJjVG9wUmFua1BhY2tldCkKCQlpZiBlcnIgIT0gbmlsIHsKCQkJYWNrID0gY2hhbm5lbHR5cGVzLk5ld0Vycm9yQWNrbm93bGVkZ2VtZW50KGVyci5FcnJvcigpKQoJCX0gZWxzZSB7CgkJCS8vIEVuY29kZSBwYWNrZXQgYWNrbm93bGVkZ21lbnQKCQkJcGFja2V0QWNrQnl0ZXMsIGVyciA6PSB0eXBlcy5Nb2R1bGVDZGMuTWFyc2hhbEpTT04oJmFtcDtwYWNrZXRBY2spCgkJCWlmIGVyciAhPSBuaWwgewoJCQkJcmV0dXJuIGNoYW5uZWx0eXBlcy5OZXdFcnJvckFja25vd2xlZGdlbWVudChzZGtlcnJvcnMuV3JhcChzZGtlcnJvcnMuRXJySlNPTk1hcnNoYWwsIGVyci5FcnJvcigpKS5FcnJvcigpKQoJCQl9CgkJCWFjayA9IGNoYW5uZWx0eXBlcy5OZXdSZXN1bHRBY2tub3dsZWRnZW1lbnQoc2RrLk11c3RTb3J0SlNPTihwYWNrZXRBY2tCeXRlcykpCgkJfQoJCWN0eC5FdmVudE1hbmFnZXIoKS5FbWl0RXZlbnQoCgkJCXNkay5OZXdFdmVudCgKCQkJCXR5cGVzLkV2ZW50VHlwZUliY1RvcFJhbmtQYWNrZXQsCgkJCQlzZGsuTmV3QXR0cmlidXRlKHNkay5BdHRyaWJ1dGVLZXlNb2R1bGUsIHR5cGVzLk1vZHVsZU5hbWUpLAoJCQkJc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5BdHRyaWJ1dGVLZXlBY2tTdWNjZXNzLCBmbXQuU3ByaW50ZigmcXVvdDsldCZxdW90OywgZXJyICE9IG5pbCkpLAoJCQkpLAoJCSkK"}}),e._v(" "),t("p",[e._v("The first line of code in the case statement calls the application's "),t("code",[e._v("OnRecvIbcTopRankPacket")]),e._v(" callback on the keeper to process the reception of the packet.")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25SZWN2SWJjVG9wUmFua1BhY2tldCBwcm9jZXNzZXMgcGFja2V0IHJlY2VwdGlvbgpmdW5jIChrIEtlZXBlcikgT25SZWN2SWJjVG9wUmFua1BhY2tldChjdHggc2RrLkNvbnRleHQsIHBhY2tldCBjaGFubmVsdHlwZXMuUGFja2V0LCBkYXRhIHR5cGVzLkliY1RvcFJhbmtQYWNrZXREYXRhKSAocGFja2V0QWNrIHR5cGVzLkliY1RvcFJhbmtQYWNrZXRBY2ssIGVyciBlcnJvcikgewoJLy8gdmFsaWRhdGUgcGFja2V0IGRhdGEgdXBvbiByZWNlaXZpbmcKCWlmIGVyciA6PSBkYXRhLlZhbGlkYXRlQmFzaWMoKTsgZXJyICE9IG5pbCB7CgkJcmV0dXJuIHBhY2tldEFjaywgZXJyCgl9CgoJLy8gVE9ETzogcGFja2V0IHJlY2VwdGlvbiBsb2dpYwoKCXJldHVybiBwYWNrZXRBY2ssIG5pbAp9Cg=="}}),e._v(" "),t("Highlightbox",{attrs:{type:"note"}},[t("p",[e._v("Remember that the "),t("code",[e._v("OnRecvPacket")]),e._v(" callback writes an acknowledgement as well (to cover the synchronous write ack case).")])]),e._v(" "),t("h3",{attrs:{id:"acknowledging-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acknowledging-packets"}},[e._v("#")]),e._v(" Acknowledging packets")]),e._v(" "),t("p",[e._v("Similarly to the "),t("code",[e._v("OnRecvPacket")]),e._v(" case, Ignite CLI already prepared the structure of the "),t("code",[e._v("OnAcknowledgementPacket")]),e._v(" with the switch statement. Again, scaffolding the packet adds a case to the switch:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQCBzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSBpbiBPbkFja25vd2xlZGdtZW50UGFja2V0CgljYXNlICp0eXBlcy5MZWFkZXJib2FyZFBhY2tldERhdGFfSWJjVG9wUmFua1BhY2tldDoKCQllcnIgOj0gYW0ua2VlcGVyLk9uQWNrbm93bGVkZ2VtZW50SWJjVG9wUmFua1BhY2tldChjdHgsIG1vZHVsZVBhY2tldCwgKnBhY2tldC5JYmNUb3BSYW5rUGFja2V0LCBhY2spCgkJaWYgZXJyICE9IG5pbCB7CgkJCXJldHVybiBlcnIKCQl9CgkJZXZlbnRUeXBlID0gdHlwZXMuRXZlbnRUeXBlSWJjVG9wUmFua1BhY2tldAo="}}),e._v(" "),t("p",[e._v("This calls into the newly created application keeper's ack packet callback:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIE9uQWNrbm93bGVkZ2VtZW50SWJjVG9wUmFua1BhY2tldChjdHggc2RrLkNvbnRleHQsIHBhY2tldCBjaGFubmVsdHlwZXMuUGFja2V0LCBkYXRhIHR5cGVzLkliY1RvcFJhbmtQYWNrZXREYXRhLCBhY2sgY2hhbm5lbHR5cGVzLkFja25vd2xlZGdlbWVudCkgZXJyb3IgewoJc3dpdGNoIGRpc3BhdGNoZWRBY2sgOj0gYWNrLlJlc3BvbnNlLih0eXBlKSB7CgljYXNlICpjaGFubmVsdHlwZXMuQWNrbm93bGVkZ2VtZW50X0Vycm9yOgoKCQkvLyBUT0RPOiBmYWlsZWQgYWNrbm93bGVkZ2VtZW50IGxvZ2ljCgkJXyA9IGRpc3BhdGNoZWRBY2suRXJyb3IKCgkJcmV0dXJuIG5pbAoJY2FzZSAqY2hhbm5lbHR5cGVzLkFja25vd2xlZGdlbWVudF9SZXN1bHQ6CgkJLy8gRGVjb2RlIHRoZSBwYWNrZXQgYWNrbm93bGVkZ21lbnQKCQl2YXIgcGFja2V0QWNrIHR5cGVzLkliY1RvcFJhbmtQYWNrZXRBY2sKCgkJaWYgZXJyIDo9IHR5cGVzLk1vZHVsZUNkYy5Vbm1hcnNoYWxKU09OKGRpc3BhdGNoZWRBY2suUmVzdWx0LCAmYW1wO3BhY2tldEFjayk7IGVyciAhPSBuaWwgewoJCQkvLyBUaGUgY291bnRlci1wYXJ0eSBtb2R1bGUgZG9lc24ndCBpbXBsZW1lbnQgdGhlIGNvcnJlY3QgYWNrbm93bGVkZ21lbnQgZm9ybWF0CgkJCXJldHVybiBlcnJvcnMuTmV3KCZxdW90O2Nhbm5vdCB1bm1hcnNoYWwgYWNrbm93bGVkZ21lbnQmcXVvdDspCgkJfQoKCQkvLyBUT0RPOiBzdWNjZXNzZnVsIGFja25vd2xlZGdlbWVudCBsb2dpYwoKCQlyZXR1cm4gbmlsCglkZWZhdWx0OgoJCS8vIFRoZSBjb3VudGVyLXBhcnR5IG1vZHVsZSBkb2Vzbid0IGltcGxlbWVudCB0aGUgY29ycmVjdCBhY2tub3dsZWRnbWVudCBmb3JtYXQKCQlyZXR1cm4gZXJyb3JzLk5ldygmcXVvdDtpbnZhbGlkIGFja25vd2xlZGdtZW50IGZvcm1hdCZxdW90OykKCX0KfQo="}}),e._v(" "),t("p",[e._v("This allows you to add custom application logic for both failed and successful acks.")]),e._v(" "),t("h3",{attrs:{id:"timing-out-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#timing-out-packets"}},[e._v("#")]),e._v(" Timing out packets")]),e._v(" "),t("p",[e._v("Timing out packets follows the same flow, adding a case to the switch statement in "),t("code",[e._v("OnTimeoutPacket")]),e._v(", calling into the keeper's timeout packet callback where the custom logic can be implemented.")]),e._v(" "),t("p",[e._v("The reader is invited to check this out independently.")]),e._v(" "),t("h3",{attrs:{id:"extra-bits"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#extra-bits"}},[e._v("#")]),e._v(" Extra bits")]),e._v(" "),t("p",[e._v("Next to the above, some other additions have been made to the "),t("code",[e._v("types")]),e._v(" package. These include "),t("code",[e._v("codec.go")]),e._v(", "),t("code",[e._v("events_ibc.go")]),e._v(", and "),t("code",[e._v("messages_ibc_top_rank.go")]),e._v(".")]),e._v(" "),t("p",[e._v("Again, the reader should check these out independently.")]),e._v(" "),t("h2",{attrs:{id:"summary"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[e._v("#")]),e._v(" Summary")]),e._v(" "),t("p",[e._v("To summarize what has been accomplished so far:")]),e._v(" "),t("ul",[t("li",[e._v("You have scaffolded a chain with an IBC enabled module, both chain and module called leaderboard.")]),e._v(" "),t("li",[e._v("Ignite CLI made sure to implement the "),t("code",[e._v("IBCModule")]),e._v(" interface, including channel handshake and packet callbacks.")]),e._v(" "),t("li",[e._v("Ignite CLI bound our IBC module to a port and added a route to the IBC router.")]),e._v(" "),t("li",[e._v("You have scaffolded an IBC packet, "),t("code",[e._v("IbcTopRankPacket")]),e._v(".")]),e._v(" "),t("li",[e._v("Ignite CLI defined the packet and ack data.")]),e._v(" "),t("li",[e._v("Ignite CLI set up the basic message handling and packet handling to send, receive, acknowledge, and timeout packets.")])]),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("Even though right now you have enabled the ability to send and receive packets, you have yet to implement application logic that will execute when this occurs. This is outside the scope of this section. The reader is invited to follow the checkers blockchain extension tutorial "),t("a",{attrs:{href:"xxxxxxxxx"}},[e._v("insert link")]),e._v(".")])]),e._v(" "),t("Highlightbox",{attrs:{type:"info"}},[t("p",[e._v("When scaffolding a packet, Ignite CLI will by default ensure the chain can act both as the sender and receiver of a packet. This is a symmetrical setup which makes sense for some applications, like ICS20.")]),e._v(" "),t("p",[e._v("However, it's also possible to have an asymmetrical setup, where one chain will always be either the source or destination chain for a given packet, but not both. In this case, you can update the message server and packet callbacks to error, for example when a chain receives a packet though it is supposed to be exclusively the destination chain.")]),e._v(" "),t("p",[e._v("Interchain Accounts, or ICS27, is an example of this asymmetrical situation, as is the checkers extension tutorial.")])])],1)}),[],!1,null,null,null);a.default=l.exports}}]);