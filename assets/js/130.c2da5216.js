(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{741:function(e,t,g){"use strict";g.r(t);var s=g(1),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,g=e._self._c||t;return g("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[g("h1",{attrs:{id:"create-custom-messages"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#create-custom-messages"}},[e._v("#")]),e._v(" Create Custom Messages")]),e._v(" "),g("HighlightBox",{attrs:{type:"prerequisite"}},[g("p",[e._v("Make sure you have all you need before proceeding:")]),e._v(" "),g("ul",[g("li",[e._v("You understand the concepts of "),g("RouterLink",{attrs:{to:"/tutorials/7-cosmjs/1-cosmjs-intro.html"}},[e._v("CosmJS")]),e._v(".")],1),e._v(" "),g("li",[e._v("You have generated the necessary TypeScript types in "),g("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/1-cosmjs-objects.html"}},[e._v("the previous tutorial")]),e._v(".")],1),e._v(" "),g("li",[e._v("You have the finished the checkers blockchain exercise. If not, you can follow that tutorial "),g("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/"}},[e._v("here")]),e._v(" or just clone and checkout the "),g("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/v1-wager-denomination",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant branch"),g("OutboundLink")],1),e._v(" that contains the final version.")],1)])]),e._v(" "),g("p",[e._v("In the previous section, you created the objects that allow you to "),g("strong",[e._v("query")]),e._v(" your checkers blockchain. Now, you will create the elements that allow you to "),g("strong",[e._v("send transactions")]),e._v(" to it.")]),e._v(" "),g("h2",{attrs:{id:"encodable-messages"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#encodable-messages"}},[e._v("#")]),e._v(" Encodable messages")]),e._v(" "),g("p",[e._v("Previously you defined in Protobuf three messages and their respective responses. You had Protobuf "),g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/generated/src/types/generated/checkers/tx.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("compile them"),g("OutboundLink")],1),e._v(". Now you will create a few instances of "),g("code",[e._v("EncodeObject")]),e._v(", similar to how this is done in CosmJS's "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/modules/bank/messages.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("bank module"),g("OutboundLink")],1),e._v(". First, collect their names and Protobuf packages. Each Protobuf type identifier is assigned its encodable type:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IGNvbnN0IHR5cGVVcmxNc2dDcmVhdGVHYW1lID0gJnF1b3Q7L2FsaWNlLmNoZWNrZXJzLmNoZWNrZXJzLk1zZ0NyZWF0ZUdhbWUmcXVvdDsKZXhwb3J0IGNvbnN0IHR5cGVVcmxNc2dDcmVhdGVHYW1lUmVzcG9uc2UgPSAmcXVvdDsvYWxpY2UuY2hlY2tlcnMuY2hlY2tlcnMuTXNnQ3JlYXRlR2FtZVJlc3BvbnNlJnF1b3Q7CmV4cG9ydCBjb25zdCB0eXBlVXJsTXNnUGxheU1vdmUgPSAmcXVvdDsvYWxpY2UuY2hlY2tlcnMuY2hlY2tlcnMuTXNnUGxheU1vdmUmcXVvdDsKZXhwb3J0IGNvbnN0IHR5cGVVcmxNc2dQbGF5TW92ZVJlc3BvbnNlID0gJnF1b3Q7L2FsaWNlLmNoZWNrZXJzLmNoZWNrZXJzLk1zZ1BsYXlNb3ZlUmVzcG9uc2UmcXVvdDsKZXhwb3J0IGNvbnN0IHR5cGVVcmxNc2dSZWplY3RHYW1lID0gJnF1b3Q7L2FsaWNlLmNoZWNrZXJzLmNoZWNrZXJzLk1zZ1JlamVjdEdhbWUmcXVvdDsKZXhwb3J0IGNvbnN0IHR5cGVVcmxNc2dSZWplY3RHYW1lUmVzcG9uc2UgPSAmcXVvdDsvYWxpY2UuY2hlY2tlcnMuY2hlY2tlcnMuTXNnUmVqZWN0R2FtZVJlc3BvbnNlJnF1b3Q7CgpleHBvcnQgY29uc3QgY2hlY2tlcnNUeXBlczogUmVhZG9ubHlBcnJheSZsdDtbc3RyaW5nLCBHZW5lcmF0ZWRUeXBlXSZndDsgPSBbCiAgICBbdHlwZVVybE1zZ0NyZWF0ZUdhbWUsIE1zZ0NyZWF0ZUdhbWVdLAogICAgW3R5cGVVcmxNc2dDcmVhdGVHYW1lUmVzcG9uc2UsIE1zZ0NyZWF0ZUdhbWVSZXNwb25zZV0sCiAgICBbdHlwZVVybE1zZ1BsYXlNb3ZlLCBNc2dQbGF5TW92ZV0sCiAgICBbdHlwZVVybE1zZ1BsYXlNb3ZlUmVzcG9uc2UsIE1zZ1BsYXlNb3ZlUmVzcG9uc2VdLAogICAgW3R5cGVVcmxNc2dSZWplY3RHYW1lLCBNc2dSZWplY3RHYW1lXSwKICAgIFt0eXBlVXJsTXNnUmVqZWN0R2FtZVJlc3BvbnNlLCBNc2dSZWplY3RHYW1lUmVzcG9uc2VdLApdCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/messages.ts#L11-L25"}}),e._v(" "),g("p",[e._v("Next proceed with the declarations. As with CosmJS, you can add an "),g("code",[e._v("isMsgXX")]),e._v(" helper for each:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IGludGVyZmFjZSBNc2dDcmVhdGVHYW1lRW5jb2RlT2JqZWN0IGV4dGVuZHMgRW5jb2RlT2JqZWN0IHsKICAgIHJlYWRvbmx5IHR5cGVVcmw6ICZxdW90Oy9hbGljZS5jaGVja2Vycy5jaGVja2Vycy5Nc2dDcmVhdGVHYW1lJnF1b3Q7CiAgICByZWFkb25seSB2YWx1ZTogUGFydGlhbCZsdDtNc2dDcmVhdGVHYW1lJmd0Owp9CgpleHBvcnQgZnVuY3Rpb24gaXNNc2dDcmVhdGVHYW1lRW5jb2RlT2JqZWN0KAogICAgZW5jb2RlT2JqZWN0OiBFbmNvZGVPYmplY3QsCik6IGVuY29kZU9iamVjdCBpcyBNc2dDcmVhdGVHYW1lRW5jb2RlT2JqZWN0IHsKICAgIHJldHVybiAoCiAgICAgICAgKGVuY29kZU9iamVjdCBhcyBNc2dDcmVhdGVHYW1lRW5jb2RlT2JqZWN0KS50eXBlVXJsID09PSB0eXBlVXJsTXNnQ3JlYXRlR2FtZQogICAgKQp9CgpleHBvcnQgaW50ZXJmYWNlIE1zZ0NyZWF0ZUdhbWVSZXNwb25zZUVuY29kZU9iamVjdC4uLiB7fQpleHBvcnQgZnVuY3Rpb24gaXNNc2dDcmVhdGVHYW1lUmVzcG9uc2VFbmNvZGVPYmplY3QoLi4uKS4uLgpleHBvcnQgaW50ZXJmYWNlIE1zZ1BsYXlNb3ZlRW5jb2RlT2JqZWN0Li4uIHt9Ci4uLgo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/messages.ts#L27-L47"}}),e._v(" "),g("p",[e._v("This needs to be repeated for each of the messages that you require. To refresh your memory, that is:")]),e._v(" "),g("ul",[g("li",[g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/messages.ts#L27-L36",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("MsgCreateGame")]),g("OutboundLink")],1)]),e._v(" "),g("li",[g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/messages.ts#L38-L47",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("MsgCreateGameResponse")]),g("OutboundLink")],1)]),e._v(" "),g("li",[g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/messages.ts#L49-L58",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("MsgPlayMove")]),g("OutboundLink")],1)]),e._v(" "),g("li",[g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/messages.ts#L60-L69",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("MsgPlayMoveResponse")]),g("OutboundLink")],1)]),e._v(" "),g("li",[g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/messages.ts#L71-L80",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("MsgRejectGame")]),g("OutboundLink")],1)]),e._v(" "),g("li",[g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/messages.ts#L82-L91",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("MsgRejectGameResponse")]),g("OutboundLink")],1)])]),e._v(" "),g("h2",{attrs:{id:"a-signing-stargate-for-checkers"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#a-signing-stargate-for-checkers"}},[e._v("#")]),e._v(" A signing Stargate for Checkers")]),e._v(" "),g("p",[e._v("This process again takes inspiration from "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/signingstargateclient.ts#L55-L69",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("SigningStargateClient")]),g("OutboundLink")],1),e._v(". Prepare by registering your new types in addition to the others, so that your client knows them all:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW1wb3J0IHsgZGVmYXVsdFJlZ2lzdHJ5VHlwZXMgfSBmcm9tICZxdW90O0Bjb3NtanMvc3RhcmdhdGUmcXVvdDsKCmV4cG9ydCBjb25zdCBjaGVja2Vyc0RlZmF1bHRSZWdpc3RyeVR5cGVzOiBSZWFkb25seUFycmF5Jmx0O1tzdHJpbmcsIEdlbmVyYXRlZFR5cGVdJmd0OyA9IFsKICAgIC4uLmRlZmF1bHRSZWdpc3RyeVR5cGVzLAogICAgLi4uY2hlY2tlcnNUeXBlcywKXQoKZnVuY3Rpb24gY3JlYXRlRGVmYXVsdFJlZ2lzdHJ5KCk6IFJlZ2lzdHJ5IHsKICAgIHJldHVybiBuZXcgUmVnaXN0cnkoY2hlY2tlcnNEZWZhdWx0UmVnaXN0cnlUeXBlcykKfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/checkers_signingstargateclient.ts#L24-L31"}}),e._v(" "),g("p",[e._v("Similar to the read-only "),g("code",[e._v("CheckersStargateClient")]),e._v(", create a "),g("code",[e._v("CheckersSigningStargateClient")]),e._v(" that inherits from "),g("code",[e._v("SigningStargateClient")]),e._v(":")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IGNsYXNzIENoZWNrZXJzU2lnbmluZ1N0YXJnYXRlQ2xpZW50IGV4dGVuZHMgU2lnbmluZ1N0YXJnYXRlQ2xpZW50IHsKICAgIHB1YmxpYyByZWFkb25seSBjaGVja2Vyc1F1ZXJ5Q2xpZW50OiBDaGVja2Vyc0V4dGVuc2lvbiB8IHVuZGVmaW5lZAoKICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgY29ubmVjdFdpdGhTaWduZXIoCiAgICAgICAgZW5kcG9pbnQ6IHN0cmluZywKICAgICAgICBzaWduZXI6IE9mZmxpbmVTaWduZXIsCiAgICAgICAgb3B0aW9uczogU2lnbmluZ1N0YXJnYXRlQ2xpZW50T3B0aW9ucyA9IHt9LAogICAgKTogUHJvbWlzZSZsdDtDaGVja2Vyc1NpZ25pbmdTdGFyZ2F0ZUNsaWVudCZndDsgewogICAgICAgIGNvbnN0IHRtQ2xpZW50ID0gYXdhaXQgVGVuZGVybWludDM0Q2xpZW50LmNvbm5lY3QoZW5kcG9pbnQpCiAgICAgICAgcmV0dXJuIG5ldyBDaGVja2Vyc1NpZ25pbmdTdGFyZ2F0ZUNsaWVudCh0bUNsaWVudCwgc2lnbmVyLCB7CiAgICAgICAgICAgIHJlZ2lzdHJ5OiBjcmVhdGVEZWZhdWx0UmVnaXN0cnkoKSwKICAgICAgICAgICAgLi4ub3B0aW9ucywKICAgICAgICB9KQogICAgfQoKICAgIHByb3RlY3RlZCBjb25zdHJ1Y3RvcigKICAgICAgICB0bUNsaWVudDogVGVuZGVybWludDM0Q2xpZW50IHwgdW5kZWZpbmVkLAogICAgICAgIHNpZ25lcjogT2ZmbGluZVNpZ25lciwKICAgICAgICBvcHRpb25zOiBTaWduaW5nU3RhcmdhdGVDbGllbnRPcHRpb25zLAogICAgKSB7CiAgICAgICAgc3VwZXIodG1DbGllbnQsIHNpZ25lciwgb3B0aW9ucykKICAgICAgICBpZiAodG1DbGllbnQpIHsKICAgICAgICAgICAgdGhpcy5jaGVja2Vyc1F1ZXJ5Q2xpZW50ID0gUXVlcnlDbGllbnQud2l0aEV4dGVuc2lvbnModG1DbGllbnQsIHNldHVwQ2hlY2tlcnNFeHRlbnNpb24pCiAgICAgICAgfQogICAgfQp9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/checkers_signingstargateclient.ts#L33-L57"}}),e._v(" "),g("p",[e._v("Note the use of "),g("code",[e._v("createDefaultRegistry")]),e._v(" as the default registry, if nothing was passed via the options.")]),e._v(" "),g("h2",{attrs:{id:"the-action-methods"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#the-action-methods"}},[e._v("#")]),e._v(" The action methods")]),e._v(" "),g("p",[e._v("Finally you ought to add the methods that allow you to interact with the blockchain. They also help advertise how to craft messages for your client. Taking inspiration from "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/signingstargateclient.ts#L180-L197",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("sendTokens")]),g("OutboundLink")],1),e._v(", create one function for each of your messages:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"cHVibGljIGFzeW5jIGNyZWF0ZUdhbWUoCiAgICBjcmVhdG9yOiBzdHJpbmcsCiAgICBibGFjazogc3RyaW5nLAogICAgcmVkOiBzdHJpbmcsCiAgICBkZW5vbTogc3RyaW5nLAogICAgd2FnZXI6IExvbmcsCiAgICBmZWU6IFN0ZEZlZSB8ICZxdW90O2F1dG8mcXVvdDsgfCBudW1iZXIsCiAgICBtZW1vID0gJnF1b3Q7JnF1b3Q7LAopOiBQcm9taXNlJmx0O0RlbGl2ZXJUeFJlc3BvbnNlJmd0OyB7CiAgICBjb25zdCBjcmVhdGVNc2c6IE1zZ0NyZWF0ZUdhbWVFbmNvZGVPYmplY3QgPSB7CiAgICAgICAgdHlwZVVybDogdHlwZVVybE1zZ0NyZWF0ZUdhbWUsCiAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgYmxhY2s6IGJsYWNrLAogICAgICAgICAgICByZWQ6IHJlZCwKICAgICAgICAgICAgY3JlYXRvcjogY3JlYXRvciwKICAgICAgICAgICAgZGVub206IGRlbm9tLAogICAgICAgICAgICB3YWdlcjogd2FnZXIsCiAgICAgICAgfSwKICAgIH0KICAgIHJldHVybiB0aGlzLnNpZ25BbmRCcm9hZGNhc3QoY3JlYXRvciwgW2NyZWF0ZU1zZ10sIGZlZSwgbWVtbykKfQoKcHVibGljIGFzeW5jIHBsYXlNb3ZlKAogICAgY3JlYXRvcjogc3RyaW5nLAogICAgZ2FtZUluZGV4OiBzdHJpbmcsCiAgICBmcm9tOiBQb3MsCiAgICB0bzogUG9zLAogICAgZmVlOiBTdGRGZWUgfCAmcXVvdDthdXRvJnF1b3Q7IHwgbnVtYmVyLAogICAgbWVtbyA9ICZxdW90OyZxdW90OywKKTogUHJvbWlzZSZsdDtEZWxpdmVyVHhSZXNwb25zZSZndDsgewogICAgY29uc3QgcGxheU1vdmVNc2c6IE1zZ1BsYXlNb3ZlRW5jb2RlT2JqZWN0ID0gewogICAgICAgIHR5cGVVcmw6IHR5cGVVcmxNc2dQbGF5TW92ZSwKICAgICAgICB2YWx1ZTogewogICAgICAgICAgICBjcmVhdG9yOiBjcmVhdG9yLAogICAgICAgICAgICBnYW1lSW5kZXg6IGdhbWVJbmRleCwKICAgICAgICAgICAgZnJvbVg6IExvbmcuZnJvbU51bWJlcihmcm9tLngpLAogICAgICAgICAgICBmcm9tWTogTG9uZy5mcm9tTnVtYmVyKGZyb20ueSksCiAgICAgICAgICAgIHRvWDogTG9uZy5mcm9tTnVtYmVyKHRvLngpLAogICAgICAgICAgICB0b1k6IExvbmcuZnJvbU51bWJlcih0by55KSwKICAgICAgICB9LAogICAgfQogICAgcmV0dXJuIHRoaXMuc2lnbkFuZEJyb2FkY2FzdChjcmVhdG9yLCBbcGxheU1vdmVNc2ddLCBmZWUsIG1lbW8pCn0KCnB1YmxpYyBhc3luYyByZWplY3RHYW1lKAogICAgY3JlYXRvcjogc3RyaW5nLAogICAgZ2FtZUluZGV4OiBzdHJpbmcsCiAgICBmZWU6IFN0ZEZlZSB8ICZxdW90O2F1dG8mcXVvdDsgfCBudW1iZXIsCiAgICBtZW1vID0gJnF1b3Q7JnF1b3Q7LAopOiBQcm9taXNlJmx0O0RlbGl2ZXJUeFJlc3BvbnNlJmd0OyB7CiAgICBjb25zdCByZWplY3RHYW1lTXNnOiBNc2dSZWplY3RHYW1lRW5jb2RlT2JqZWN0ID0gewogICAgICAgIHR5cGVVcmw6IHR5cGVVcmxNc2dSZWplY3RHYW1lLAogICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgIGNyZWF0b3I6IGNyZWF0b3IsCiAgICAgICAgICAgIGdhbWVJbmRleDogZ2FtZUluZGV4LAogICAgICAgIH0sCiAgICB9CiAgICByZXR1cm4gdGhpcy5zaWduQW5kQnJvYWRjYXN0KGNyZWF0b3IsIFtyZWplY3RHYW1lTXNnXSwgZmVlLCBtZW1vKQp9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/checkers_signingstargateclient.ts#L59-L117"}}),e._v(" "),g("h2",{attrs:{id:"integration-tests"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#integration-tests"}},[e._v("#")]),e._v(" Integration tests")]),e._v(" "),g("p",[e._v("You can reuse the setup you prepared in the previous section. There is an added difficulty: because you send transactions, your tests need access to keys. How do you provide them in a testing context?")]),e._v(" "),g("h3",{attrs:{id:"key-preparation"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#key-preparation"}},[e._v("#")]),e._v(" Key preparation")]),e._v(" "),g("p",[e._v("You would not treat mainnet keys in this way, but here you save testing keys on disk. Update "),g("code",[e._v(".env")]),e._v(" with the test mnemonics of your choice:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"TU5FTU9OSUNfVEVTVF9BTElDRT0mcXVvdDt0aGVvcnkgYXJyb3cgYmx1ZSBtdWNoIGlsbG5lc3MgY2FycGV0IGFyZW5hIHRob3VnaHQgY2xheSBvZmZpY2UgcGF0aCBtdXNldW0gaWRlYSB0ZXh0IGZvb3QgYmFjb24gdW50aWwgdHJhZ2ljIGluZm9ybSBzdGFpcnMgcGl0Y2ggZGFuZ2VyIHNwYXRpYWwgc2xpZ2h0JnF1b3Q7CkFERFJFU1NfVEVTVF9BTElDRT0mcXVvdDtjb3Ntb3MxZng2cWx4d3RlZXF4Z3h3c3c4M3drZjRzOWZjbm53azh6ODZzcWwmcXVvdDsKTU5FTU9OSUNfVEVTVF9CT0I9JnF1b3Q7YXBwbGUgc3BvaWwgbWVsb2R5IHZlbnR1cmUgc3BlZWQgbGlrZSBkYXduIGNoZXJyeSBpbnNhbmUgcHJvZHVjZSBjYXJyeSByb2J1c3QgZHVjayBsYW5ndWFnZSBuZXh0IGVsZWN0cmljIGVwaXNvZGUgY2xpbmljIGFjaWQgc2hlcmlmZiB2aWRlbyBrbmVlIHNwb2lsIG11bHRpcGx5JnF1b3Q7CkFERFJFU1NfVEVTVF9CT0I9JnF1b3Q7Y29zbW9zMW1xbDlhYXV4MzQ1M3RkZ2hrNnJ6a21rNDNzdHh2bnZoYTRudjIyJnF1b3Q7Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/.env#L3-L6"}}),e._v(" "),g("p",[e._v("If you use different mnemonics and do not yet know the corresponding addresses, you can get them from the "),g("code",[e._v("before")]),e._v(" action (below) when it fails. Also adjust "),g("code",[e._v("environment.d.ts")]),e._v(" to inform the TypeScript compiler:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZGVjbGFyZSBnbG9iYWwgewogICAgbmFtZXNwYWNlIE5vZGVKUyB7CiAgICAgICAgaW50ZXJmYWNlIFByb2Nlc3NFbnYgewogICAgICAgICAgICAuLi4KICAgICAgICAgICAgTU5FTU9OSUNfVEVTVF9BTElDRTogc3RyaW5nCiAgICAgICAgICAgIEFERFJFU1NfVEVTVF9BTElDRTogc3RyaW5nCiAgICAgICAgICAgIE1ORU1PTklDX1RFU1RfQk9COiBzdHJpbmcKICAgICAgICAgICAgQUREUkVTU19URVNUX0JPQjogc3RyaW5nCiAgICAgICAgfQogICAgfQp9Ci4uLgo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/environment.d.ts#L6-L9"}}),e._v(" "),g("p",[e._v("In a new separate file, define how you build a signer from the mnemonic:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW1wb3J0IHsgRGlyZWN0U2VjcDI1NmsxSGRXYWxsZXQsIE9mZmxpbmVEaXJlY3RTaWduZXIgfSBmcm9tICZxdW90O0Bjb3NtanMvcHJvdG8tc2lnbmluZyZxdW90OwoKZXhwb3J0IGNvbnN0IGdldFNpZ25lckZyb21NbmVtb25pYyA9IGFzeW5jIChtbmVtb25pYzogc3RyaW5nKTogUHJvbWlzZSZsdDtPZmZsaW5lRGlyZWN0U2lnbmVyJmd0OyA9Jmd0OyB7CiAgICByZXR1cm4gRGlyZWN0U2VjcDI1NmsxSGRXYWxsZXQuZnJvbU1uZW1vbmljKG1uZW1vbmljLCB7CiAgICAgICAgcHJlZml4OiAmcXVvdDtjb3Ntb3MmcXVvdDssCiAgICB9KQp9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/util/signer.ts#L1-L8"}}),e._v(" "),g("p",[e._v("Create a new "),g("code",[e._v("stored-game-action.ts")]),e._v(" integration test file, modeled on "),g("code",[e._v("stored-game.ts")]),e._v(", that starts by preparing the signers and confirms the match between mnemonics and first addresses:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgeyBSUENfVVJMLCBBRERSRVNTX1RFU1RfQUxJQ0U6IGFsaWNlLCBBRERSRVNTX1RFU1RfQk9COiBib2IgfSA9IHByb2Nlc3MuZW52CmxldCBhbGljZVNpZ25lcjogT2ZmbGluZURpcmVjdFNpZ25lciwgYm9iU2lnbmVyOiBPZmZsaW5lRGlyZWN0U2lnbmVyCgpiZWZvcmUoJnF1b3Q7Y3JlYXRlIHNpZ25lcnMmcXVvdDssIGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgIGFsaWNlU2lnbmVyID0gYXdhaXQgZ2V0U2lnbmVyRnJvbU1uZW1vbmljKHByb2Nlc3MuZW52Lk1ORU1PTklDX1RFU1RfQUxJQ0UpCiAgICBib2JTaWduZXIgPSBhd2FpdCBnZXRTaWduZXJGcm9tTW5lbW9uaWMocHJvY2Vzcy5lbnYuTU5FTU9OSUNfVEVTVF9CT0IpCiAgICBleHBlY3QoKGF3YWl0IGFsaWNlU2lnbmVyLmdldEFjY291bnRzKCkpWzBdLmFkZHJlc3MpLnRvLmVxdWFsKGFsaWNlKQogICAgZXhwZWN0KChhd2FpdCBib2JTaWduZXIuZ2V0QWNjb3VudHMoKSlbMF0uYWRkcmVzcykudG8uZXF1YWwoYm9iKQp9KQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L30-L38"}}),e._v(" "),g("p",[e._v("These early test do not need any running chain, so go ahead and make sure they pass. Add a temporary empty "),g("code",[e._v("it")]),e._v(" test and run:")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBucG0gdGVzdAo="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IC12ICQocHdkKTovY2xpZW50IC13IC9jbGllbnQgbm9kZToxOC43IG5wbSB0ZXN0Cg=="}})],1)],1),e._v(" "),g("p",[e._v("With this confirmation, you can add another "),g("code",[e._v("before")]),e._v(" that creates the signing clients:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"bGV0IGFsaWNlQ2xpZW50OiBDaGVja2Vyc1NpZ25pbmdTdGFyZ2F0ZUNsaWVudCwKICAgIGJvYkNsaWVudDogQ2hlY2tlcnNTaWduaW5nU3RhcmdhdGVDbGllbnQsCiAgICBjaGVja2VyczogQ2hlY2tlcnNFeHRlbnNpb25bJnF1b3Q7Y2hlY2tlcnMmcXVvdDtdCgpiZWZvcmUoJnF1b3Q7Y3JlYXRlIHNpZ25pbmcgY2xpZW50cyZxdW90OywgYXN5bmMgZnVuY3Rpb24gKCkgewogICAgYWxpY2VDbGllbnQgPSBhd2FpdCBDaGVja2Vyc1NpZ25pbmdTdGFyZ2F0ZUNsaWVudC5jb25uZWN0V2l0aFNpZ25lcihSUENfVVJMLCBhbGljZVNpZ25lciwgewogICAgICAgIGdhc1ByaWNlOiBHYXNQcmljZS5mcm9tU3RyaW5nKCZxdW90OzBzdGFrZSZxdW90OyksCiAgICB9KQogICAgYm9iQ2xpZW50ID0gYXdhaXQgQ2hlY2tlcnNTaWduaW5nU3RhcmdhdGVDbGllbnQuY29ubmVjdFdpdGhTaWduZXIoUlBDX1VSTCwgYm9iU2lnbmVyLCB7CiAgICAgICAgZ2FzUHJpY2U6IEdhc1ByaWNlLmZyb21TdHJpbmcoJnF1b3Q7MHN0YWtlJnF1b3Q7KSwKICAgIH0pCiAgICBjaGVja2VycyA9IGFsaWNlQ2xpZW50LmNoZWNrZXJzUXVlcnlDbGllbnQhLmNoZWNrZXJzCn0pCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L40-L52"}}),e._v(" "),g("p",[e._v("If the running chain allows it, and to make your life easier, you can set the gas price to "),g("code",[e._v("0")]),e._v(". If not, set it as low as possible.")]),e._v(" "),g("h3",{attrs:{id:"token-preparation"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#token-preparation"}},[e._v("#")]),e._v(" Token preparation")]),e._v(" "),g("p",[e._v("Just saving keys on disk does not magically make these keys hold tokens on your test blockchain. You need to fund them at their addresses using the funds of other addresses of your running chain. If you use Ignite, it has created a faucet end point for you at port "),g("code",[e._v("4500")]),e._v(". The page "),g("code",[e._v("http://localhost:4500")]),e._v(" explains how to make the calls. Use that.")]),e._v(" "),g("p",[e._v("Add the faucet address in "),g("code",[e._v(".env")]),e._v(":")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"RkFVQ0VUX1VSTD0mcXVvdDtodHRwOi8vbG9jYWxob3N0OjQ1MDAmcXVvdDsK",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/.env#L2"}}),e._v(" "),g("p",[e._v("Also add the faucet address to "),g("code",[e._v("environment.d.ts")]),e._v(":")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZGVjbGFyZSBnbG9iYWwgewogICAgbmFtZXNwYWNlIE5vZGVKUyB7CiAgICAgICAgaW50ZXJmYWNlIFByb2Nlc3NFbnYgewogICAgICAgICAgICBSUENfVVJMOiBzdHJpbmcKICAgICAgICAgICAgRkFVQ0VUX1VSTDogc3RyaW5nCiAgICAgICAgICAgIC4uLgogICAgICAgIH0KICAgIH0KfQouLi4K",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/environment.d.ts#L5"}}),e._v(" "),g("p",[e._v("In a new separate file, add two helper functions to easily call the faucet:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IGNvbnN0IGh0dHBSZXF1ZXN0ID0gYXN5bmMgKHVybDogc3RyaW5nIHwgVVJMLCBvcHRpb25zOiBSZXF1ZXN0T3B0aW9ucywgcG9zdERhdGE6IHN0cmluZykgPSZndDsgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0mZ3Q7IHsKICAgICAgICBsZXQgYWxsID0gJnF1b3Q7JnF1b3Q7CiAgICAgICAgY29uc3QgcmVxID0gaHR0cC5yZXF1ZXN0KHVybCwgb3B0aW9ucywgKHJlc3BvbnNlOiBJbmNvbWluZ01lc3NhZ2UpID0mZ3Q7IHsKICAgICAgICAgICAgcmVzcG9uc2Uuc2V0RW5jb2RpbmcoJnF1b3Q7dXRmOCZxdW90OykKICAgICAgICAgICAgcmVzcG9uc2Uub24oJnF1b3Q7ZXJyb3ImcXVvdDssIHJlamVjdCkKICAgICAgICAgICAgcmVzcG9uc2Uub24oJnF1b3Q7ZW5kJnF1b3Q7LCAoKSA9Jmd0OyByZXNvbHZlKGFsbCkpCiAgICAgICAgICAgIHJlc3BvbnNlLm9uKCZxdW90O2RhdGEmcXVvdDssIChjaHVuaykgPSZndDsgKGFsbCA9IGFsbCArIGNodW5rKSkKICAgICAgICB9KQogICAgICAgIHJlcS53cml0ZShwb3N0RGF0YSkKICAgICAgICByZXEuZW5kKCkKICAgIH0pCn0KCmV4cG9ydCBjb25zdCBhc2tGYXVjZXQgPSBhc3luYyAoYWRkcmVzczogc3RyaW5nLCB0b2tlbnM6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0pID0mZ3Q7CiAgICBodHRwUmVxdWVzdCgKICAgICAgICBwcm9jZXNzLmVudi5GQVVDRVRfVVJMLAogICAgICAgIHsKICAgICAgICAgICAgbWV0aG9kOiAmcXVvdDtQT1NUJnF1b3Q7LAogICAgICAgIH0sCiAgICAgICAgSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICBhZGRyZXNzOiBhZGRyZXNzLAogICAgICAgICAgICBjb2luczogT2JqZWN0LmVudHJpZXModG9rZW5zKS5tYXAoKFtrZXksIHZhbHVlXSkgPSZndDsgdmFsdWUgKyBrZXkpLAogICAgICAgIH0pLAogICAgKQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/util/faucet.ts#L4-L28"}}),e._v(" "),g("p",[e._v("You will find out with practice how many tokens your accounts need for the tests. Start with any value. Create another "),g("code",[e._v("before")]),e._v(" that will credit Alice and Bob from the faucet and confirm that they are rich enough to continue:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgYWxpY2VDcmVkaXQgPSB7CiAgICAgICAgc3Rha2U6IDEwMCwKICAgICAgICB0b2tlbjogMSwKICAgIH0sCiAgICBib2JDcmVkaXQgPSB7CiAgICAgICAgc3Rha2U6IDEwMCwKICAgICAgICB0b2tlbjogMSwKICAgIH0KCmJlZm9yZSgmcXVvdDtjcmVkaXQgdGVzdCBhY2NvdW50cyZxdW90OywgYXN5bmMgZnVuY3Rpb24gKCkgewogICAgdGhpcy50aW1lb3V0KDEwXzAwMCkKICAgIGF3YWl0IGFza0ZhdWNldChhbGljZSwgYWxpY2VDcmVkaXQpCiAgICBhd2FpdCBhc2tGYXVjZXQoYm9iLCBib2JDcmVkaXQpCiAgICBleHBlY3QocGFyc2VJbnQoKGF3YWl0IGFsaWNlQ2xpZW50LmdldEJhbGFuY2UoYWxpY2UsICZxdW90O3N0YWtlJnF1b3Q7KSkuYW1vdW50LCAxMCkpLnRvLmJlLmdyZWF0ZXJUaGFuT3JFcXVhbCgKICAgICAgICBhbGljZUNyZWRpdC5zdGFrZSwKICAgICkKICAgIGV4cGVjdChwYXJzZUludCgoYXdhaXQgYWxpY2VDbGllbnQuZ2V0QmFsYW5jZShhbGljZSwgJnF1b3Q7dG9rZW4mcXVvdDspKS5hbW91bnQsIDEwKSkudG8uYmUuZ3JlYXRlclRoYW5PckVxdWFsKAogICAgICAgIGFsaWNlQ3JlZGl0LnRva2VuLAogICAgKQogICAgZXhwZWN0KHBhcnNlSW50KChhd2FpdCBib2JDbGllbnQuZ2V0QmFsYW5jZShib2IsICZxdW90O3N0YWtlJnF1b3Q7KSkuYW1vdW50LCAxMCkpLnRvLmJlLmdyZWF0ZXJUaGFuT3JFcXVhbCgKICAgICAgICBib2JDcmVkaXQuc3Rha2UsCiAgICApCiAgICBleHBlY3QocGFyc2VJbnQoKGF3YWl0IGJvYkNsaWVudC5nZXRCYWxhbmNlKGJvYiwgJnF1b3Q7dG9rZW4mcXVvdDspKS5hbW91bnQsIDEwKSkudG8uYmUuZ3JlYXRlclRoYW5PckVxdWFsKAogICAgICAgIGJvYkNyZWRpdC50b2tlbiwKICAgICkKfSkK",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L54-L79"}}),e._v(" "),g("HighlightBox",{attrs:{type:"note"}},[g("p",[e._v("The extra 10 seconds given for this potentially slower process: "),g("code",[e._v("this.timeout(10_000)")]),e._v(". Your accounts are now ready to proceed with the tests proper.")])]),e._v(" "),g("h3",{attrs:{id:"adding-tests"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#adding-tests"}},[e._v("#")]),e._v(" Adding tests")]),e._v(" "),g("p",[e._v("Since these integration tests make calls to a running chain, they need to run one after the other. And if one "),g("code",[e._v("it")]),e._v(" fails, all the "),g("code",[e._v("it")]),e._v(" tests that come after will fail too. This is not ideal but is how these examples will work.")]),e._v(" "),g("p",[e._v("With a view to reusing them, add convenience methods that encapsulate the extraction of information from the events:")]),e._v(" "),g("ul",[g("li",[g("p",[e._v("To get the id of the game created:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IHR5cGUgR2FtZUNyZWF0ZWRFdmVudCA9IEV2ZW50CgpleHBvcnQgY29uc3QgZ2V0Q3JlYXRlR2FtZUV2ZW50ID0gKGxvZzogTG9nKTogR2FtZUNyZWF0ZWRFdmVudCB8IHVuZGVmaW5lZCA9Jmd0OwogICAgbG9nLmV2ZW50cyEuZmluZCgoZXZlbnQ6IEV2ZW50KSA9Jmd0OyBldmVudC50eXBlID09PSAmcXVvdDtuZXctZ2FtZS1jcmVhdGVkJnF1b3Q7KQoKZXhwb3J0IGNvbnN0IGdldENyZWF0ZWRHYW1lSWQgPSAoY3JlYXRlZEdhbWVFdmVudDogR2FtZUNyZWF0ZWRFdmVudCk6IHN0cmluZyA9Jmd0OwogICAgY3JlYXRlZEdhbWVFdmVudC5hdHRyaWJ1dGVzLmZpbmQoKGF0dHJpYnV0ZTogQXR0cmlidXRlKSA9Jmd0OyBhdHRyaWJ1dGUua2V5ID09ICZxdW90O2dhbWUtaW5kZXgmcXVvdDspIS52YWx1ZQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/events.ts#L4-L10"}})],1),e._v(" "),g("li",[g("p",[e._v("To get the captured position and the winner if they exist:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IHR5cGUgTW92ZVBsYXllZEV2ZW50ID0gRXZlbnQKCmV4cG9ydCBjb25zdCBnZXRNb3ZlUGxheWVkRXZlbnQgPSAobG9nOiBMb2cpOiBNb3ZlUGxheWVkRXZlbnQgfCB1bmRlZmluZWQgPSZndDsKICAgIGxvZy5ldmVudHMhLmZpbmQoKGV2ZW50OiBFdmVudCkgPSZndDsgZXZlbnQudHlwZSA9PT0gJnF1b3Q7bW92ZS1wbGF5ZWQmcXVvdDspCgpleHBvcnQgY29uc3QgZ2V0Q2FwdHVyZWRQb3MgPSAobW92ZVBsYXllZEV2ZW50OiBNb3ZlUGxheWVkRXZlbnQpOiBQb3MgfCB1bmRlZmluZWQgPSZndDsgewogICAgY29uc3QgeDogbnVtYmVyID0gcGFyc2VJbnQoCiAgICAgICAgbW92ZVBsYXllZEV2ZW50LmF0dHJpYnV0ZXMuZmluZCgoYXR0cmlidXRlOiBBdHRyaWJ1dGUpID0mZ3Q7IGF0dHJpYnV0ZS5rZXkgPT0gJnF1b3Q7Y2FwdHVyZWQteCZxdW90OykhLnZhbHVlLAogICAgICAgIDEwLAogICAgKQogICAgY29uc3QgeSA9IHBhcnNlSW50KAogICAgICAgIG1vdmVQbGF5ZWRFdmVudC5hdHRyaWJ1dGVzLmZpbmQoKGF0dHJpYnV0ZTogQXR0cmlidXRlKSA9Jmd0OyBhdHRyaWJ1dGUua2V5ID09ICZxdW90O2NhcHR1cmVkLXkmcXVvdDspIS52YWx1ZSwKICAgICAgICAxMCwKICAgICkKICAgIGlmIChpc05hTih4KSB8fCBpc05hTih5KSkgcmV0dXJuIHVuZGVmaW5lZAogICAgcmV0dXJuIHsgeCwgeSB9Cn0KCmV4cG9ydCBjb25zdCBnZXRXaW5uZXIgPSAobW92ZVBsYXllZEV2ZW50OiBNb3ZlUGxheWVkRXZlbnQpOiBHYW1lUGllY2UgfCB1bmRlZmluZWQgPSZndDsKICAgIG1vdmVQbGF5ZWRFdmVudC5hdHRyaWJ1dGVzLmZpbmQoKGF0dHJpYnV0ZTogQXR0cmlidXRlKSA9Jmd0OyBhdHRyaWJ1dGUua2V5ID09ICZxdW90O3dpbm5lciZxdW90OykhLnZhbHVlIGFzCiAgICAgICAgfCBHYW1lUGllY2UKICAgICAgICB8IHVuZGVmaW5lZAo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/events.ts#L12-L33"}}),e._v(" "),g("p",[e._v("Here you also define "),g("code",[e._v("GamePiece")]),e._v(" as:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IHR5cGUgR2FtZVBpZWNlID0gUGxheWVyIHwgJnF1b3Q7KiZxdW90Owo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/player.ts#L2"}})],1)]),e._v(" "),g("h3",{attrs:{id:"create-and-play"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#create-and-play"}},[e._v("#")]),e._v(" Create and Play")]),e._v(" "),g("p",[e._v("Start by creating a game, extracting its index from the logs, and confirming that you can fetch it.")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"bGV0IGdhbWVJbmRleDogc3RyaW5nCgppdCgmcXVvdDtjYW4gY3JlYXRlIGdhbWUgd2l0aCB3YWdlciZxdW90OywgYXN5bmMgZnVuY3Rpb24gKCkgewogICAgdGhpcy50aW1lb3V0KDVfMDAwKQogICAgY29uc3QgcmVzcG9uc2U6IERlbGl2ZXJUeFJlc3BvbnNlID0gYXdhaXQgYWxpY2VDbGllbnQuY3JlYXRlR2FtZSgKICAgICAgICBhbGljZSwKICAgICAgICBhbGljZSwKICAgICAgICBib2IsCiAgICAgICAgJnF1b3Q7dG9rZW4mcXVvdDssCiAgICAgICAgTG9uZy5mcm9tTnVtYmVyKDEpLAogICAgICAgICZxdW90O2F1dG8mcXVvdDssCiAgICApCiAgICBjb25zdCBsb2dzOiBMb2dbXSA9IEpTT04ucGFyc2UocmVzcG9uc2UucmF3TG9nISkKICAgIGV4cGVjdChsb2dzKS50by5iZS5sZW5ndGgoMSkKICAgIGdhbWVJbmRleCA9IGdldENyZWF0ZWRHYW1lSWQoZ2V0Q3JlYXRlR2FtZUV2ZW50KGxvZ3NbMF0pISkKICAgIGNvbnN0IGdhbWU6IFN0b3JlZEdhbWUgPSAoYXdhaXQgY2hlY2tlcnMuZ2V0U3RvcmVkR2FtZShnYW1lSW5kZXgpKSEKICAgIGV4cGVjdChnYW1lKS50by5pbmNsdWRlKHsKICAgICAgICBpbmRleDogZ2FtZUluZGV4LAogICAgICAgIGJsYWNrOiBhbGljZSwKICAgICAgICByZWQ6IGJvYiwKICAgICAgICBkZW5vbTogJnF1b3Q7dG9rZW4mcXVvdDssCiAgICB9KQogICAgZXhwZWN0KGdhbWUud2FnZXIudG9OdW1iZXIoKSkudG8uZXF1YWwoMSkKfSkK",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L81-L104"}}),e._v(" "),g("p",[e._v("Next, add a test that confirms that the wager tokens are consumed on first play:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aXQoJnF1b3Q7Y2FuIHBsYXkgZmlyc3QgbW92ZXMgYW5kIHBheSB3YWdlciZxdW90OywgYXN5bmMgZnVuY3Rpb24gKCkgewogICAgdGhpcy50aW1lb3V0KDEwXzAwMCkKICAgIGNvbnN0IGFsaWNlQmFsQmVmb3JlID0gcGFyc2VJbnQoKGF3YWl0IGFsaWNlQ2xpZW50LmdldEJhbGFuY2UoYWxpY2UsICZxdW90O3Rva2VuJnF1b3Q7KSkuYW1vdW50LCAxMCkKICAgIGF3YWl0IGFsaWNlQ2xpZW50LnBsYXlNb3ZlKGFsaWNlLCBnYW1lSW5kZXgsIHsgeDogMSwgeTogMiB9LCB7IHg6IDIsIHk6IDMgfSwgJnF1b3Q7YXV0byZxdW90OykKICAgIGV4cGVjdChwYXJzZUludCgoYXdhaXQgYWxpY2VDbGllbnQuZ2V0QmFsYW5jZShhbGljZSwgJnF1b3Q7dG9rZW4mcXVvdDspKS5hbW91bnQsIDEwKSkudG8uYmUuZXF1YWwoCiAgICAgICAgYWxpY2VCYWxCZWZvcmUgLSAxLAogICAgKQogICAgY29uc3QgYm9iQmFsQmVmb3JlID0gcGFyc2VJbnQoKGF3YWl0IGFsaWNlQ2xpZW50LmdldEJhbGFuY2UoYm9iLCAmcXVvdDt0b2tlbiZxdW90OykpLmFtb3VudCwgMTApCiAgICBhd2FpdCBib2JDbGllbnQucGxheU1vdmUoYm9iLCBnYW1lSW5kZXgsIHsgeDogMCwgeTogNSB9LCB7IHg6IDEsIHk6IDQgfSwgJnF1b3Q7YXV0byZxdW90OykKICAgIGV4cGVjdChwYXJzZUludCgoYXdhaXQgYWxpY2VDbGllbnQuZ2V0QmFsYW5jZShib2IsICZxdW90O3Rva2VuJnF1b3Q7KSkuYW1vdW50LCAxMCkpLnRvLmJlLmVxdWFsKAogICAgICAgIGJvYkJhbEJlZm9yZSAtIDEsCiAgICApCn0pCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L106-L118"}}),e._v(" "),g("p",[e._v("These first tests demonstrate the use of the "),g("code",[e._v("createGame")]),e._v(" and "),g("code",[e._v("playMove")]),e._v(" functions you created. These functions send a single message per transaction, and wait for the transaction to be included in a block before moving on.")]),e._v(" "),g("p",[e._v("In the next paragraphs you:")]),e._v(" "),g("ol",[g("li",[e._v("Will send many transactions in a single block.")]),e._v(" "),g("li",[e._v("Will send a transaction with more than one message in it.")])]),e._v(" "),g("p",[e._v("The transaction with more than one message that you will send is where Alice, the black player, "),g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/player.ts#L39-L41",target:"_blank",rel:"noopener noreferrer"}},[e._v("captures two red pieces in two successive moves"),g("OutboundLink")],1),e._v(". The checkers rules allow this.")]),e._v(" "),g("p",[e._v("The many transactions per block will be those that make the game reach that point.")]),e._v(" "),g("p",[e._v("Prepare the game moves of a complete game:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IGludGVyZmFjZSBHYW1lTW92ZSB7CiAgICBwbGF5ZXI6IFBsYXllcgogICAgZnJvbTogUG9zCiAgICB0bzogUG9zCn0KCmV4cG9ydCBjb25zdCBjb21wbGV0ZUdhbWU6IEdhbWVNb3ZlW10gPSBbCiAgICB7IHBsYXllcjogJnF1b3Q7YiZxdW90OywgZnJvbTogeyB4OiAxLCB5OiAyIH0sIHRvOiB7IHg6IDIsIHk6IDMgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O3ImcXVvdDssIGZyb206IHsgeDogMCwgeTogNSB9LCB0bzogeyB4OiAxLCB5OiA0IH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtiJnF1b3Q7LCBmcm9tOiB7IHg6IDIsIHk6IDMgfSwgdG86IHsgeDogMCwgeTogNSB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7ciZxdW90OywgZnJvbTogeyB4OiA0LCB5OiA1IH0sIHRvOiB7IHg6IDMsIHk6IDQgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O2ImcXVvdDssIGZyb206IHsgeDogMywgeTogMiB9LCB0bzogeyB4OiAyLCB5OiAzIH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtyJnF1b3Q7LCBmcm9tOiB7IHg6IDMsIHk6IDQgfSwgdG86IHsgeDogMSwgeTogMiB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7YiZxdW90OywgZnJvbTogeyB4OiAwLCB5OiAxIH0sIHRvOiB7IHg6IDIsIHk6IDMgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O3ImcXVvdDssIGZyb206IHsgeDogMiwgeTogNSB9LCB0bzogeyB4OiAzLCB5OiA0IH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtiJnF1b3Q7LCBmcm9tOiB7IHg6IDIsIHk6IDMgfSwgdG86IHsgeDogNCwgeTogNSB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7ciZxdW90OywgZnJvbTogeyB4OiA1LCB5OiA2IH0sIHRvOiB7IHg6IDMsIHk6IDQgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O2ImcXVvdDssIGZyb206IHsgeDogNSwgeTogMiB9LCB0bzogeyB4OiA0LCB5OiAzIH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtyJnF1b3Q7LCBmcm9tOiB7IHg6IDMsIHk6IDQgfSwgdG86IHsgeDogNSwgeTogMiB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7YiZxdW90OywgZnJvbTogeyB4OiA2LCB5OiAxIH0sIHRvOiB7IHg6IDQsIHk6IDMgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O3ImcXVvdDssIGZyb206IHsgeDogNiwgeTogNSB9LCB0bzogeyB4OiA1LCB5OiA0IH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtiJnF1b3Q7LCBmcm9tOiB7IHg6IDQsIHk6IDMgfSwgdG86IHsgeDogNiwgeTogNSB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7ciZxdW90OywgZnJvbTogeyB4OiA3LCB5OiA2IH0sIHRvOiB7IHg6IDUsIHk6IDQgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O2ImcXVvdDssIGZyb206IHsgeDogNywgeTogMiB9LCB0bzogeyB4OiA2LCB5OiAzIH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtyJnF1b3Q7LCBmcm9tOiB7IHg6IDUsIHk6IDQgfSwgdG86IHsgeDogNywgeTogMiB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7YiZxdW90OywgZnJvbTogeyB4OiA0LCB5OiAxIH0sIHRvOiB7IHg6IDMsIHk6IDIgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O3ImcXVvdDssIGZyb206IHsgeDogMywgeTogNiB9LCB0bzogeyB4OiA0LCB5OiA1IH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtiJnF1b3Q7LCBmcm9tOiB7IHg6IDUsIHk6IDAgfSwgdG86IHsgeDogNCwgeTogMSB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7ciZxdW90OywgZnJvbTogeyB4OiAyLCB5OiA3IH0sIHRvOiB7IHg6IDMsIHk6IDYgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O2ImcXVvdDssIGZyb206IHsgeDogMCwgeTogNSB9LCB0bzogeyB4OiAyLCB5OiA3IH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtyJnF1b3Q7LCBmcm9tOiB7IHg6IDQsIHk6IDUgfSwgdG86IHsgeDogMywgeTogNCB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7YiZxdW90OywgZnJvbTogeyB4OiAyLCB5OiA3IH0sIHRvOiB7IHg6IDQsIHk6IDUgfSB9LAogICAgIC8vIHBsYXllciBjYXB0dXJlcyBhZ2FpbgogICAgeyBwbGF5ZXI6ICZxdW90O2ImcXVvdDssIGZyb206IHsgeDogNCwgeTogNSB9LCB0bzogeyB4OiAyLCB5OiAzIH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtyJnF1b3Q7LCBmcm9tOiB7IHg6IDYsIHk6IDcgfSwgdG86IHsgeDogNSwgeTogNiB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7YiZxdW90OywgZnJvbTogeyB4OiAyLCB5OiAzIH0sIHRvOiB7IHg6IDMsIHk6IDQgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O3ImcXVvdDssIGZyb206IHsgeDogMCwgeTogNyB9LCB0bzogeyB4OiAxLCB5OiA2IH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtiJnF1b3Q7LCBmcm9tOiB7IHg6IDMsIHk6IDIgfSwgdG86IHsgeDogNCwgeTogMyB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7ciZxdW90OywgZnJvbTogeyB4OiA3LCB5OiAyIH0sIHRvOiB7IHg6IDYsIHk6IDEgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O2ImcXVvdDssIGZyb206IHsgeDogNywgeTogMCB9LCB0bzogeyB4OiA1LCB5OiAyIH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtyJnF1b3Q7LCBmcm9tOiB7IHg6IDEsIHk6IDYgfSwgdG86IHsgeDogMiwgeTogNSB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7YiZxdW90OywgZnJvbTogeyB4OiAzLCB5OiA0IH0sIHRvOiB7IHg6IDEsIHk6IDYgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O3ImcXVvdDssIGZyb206IHsgeDogNCwgeTogNyB9LCB0bzogeyB4OiAzLCB5OiA2IH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtiJnF1b3Q7LCBmcm9tOiB7IHg6IDQsIHk6IDMgfSwgdG86IHsgeDogMywgeTogNCB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7ciZxdW90OywgZnJvbTogeyB4OiA1LCB5OiA2IH0sIHRvOiB7IHg6IDQsIHk6IDUgfSB9LAogICAgeyBwbGF5ZXI6ICZxdW90O2ImcXVvdDssIGZyb206IHsgeDogMywgeTogNCB9LCB0bzogeyB4OiA1LCB5OiA2IH0gfSwKICAgIHsgcGxheWVyOiAmcXVvdDtyJnF1b3Q7LCBmcm9tOiB7IHg6IDMsIHk6IDYgfSwgdG86IHsgeDogMiwgeTogNSB9IH0sCiAgICB7IHBsYXllcjogJnF1b3Q7YiZxdW90OywgZnJvbTogeyB4OiAxLCB5OiA2IH0sIHRvOiB7IHg6IDMsIHk6IDQgfSB9LApdCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/player.ts#L8-L56"}}),e._v(" "),g("HighlightBox",{attrs:{type:"note"}},[g("p",[e._v("Note how you already played the first two.")])]),e._v(" "),g("h3",{attrs:{id:"multiple-transactions-in-a-block"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#multiple-transactions-in-a-block"}},[e._v("#")]),e._v(" Multiple transactions in a block")]),e._v(" "),g("p",[e._v("You are going to send "),g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/player.ts#L17-L38",target:"_blank",rel:"noopener noreferrer"}},[e._v("22 transactions"),g("OutboundLink")],1),e._v(" in as quick a succession as possible. If you waited for each to be included in a block, it would take you in the order of "),g("code",[e._v("22*5 == 110")]),e._v(" seconds. That's very long for a test. It is better to find a way to include more transactions per block.")]),e._v(" "),g("p",[e._v("You will face several difficulties when you want to send multiple transactions in a single block. The "),g("strong",[e._v("first difficulty")]),e._v(" is as follows:")]),e._v(" "),g("ol",[g("li",[e._v("Each transaction signed by an account must mention the correct "),g("code",[e._v("sequence")]),e._v(" of that account at the time of inclusion in the block. This is to make sure transactions are added in the right order and to prevent transaction replay.")]),e._v(" "),g("li",[e._v("After each transaction, this "),g("code",[e._v("sequence")]),e._v(" number increments, ready to be used for the next transaction of the account.")]),e._v(" "),g("li",[e._v("The signing client's "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/signingstargateclient.ts#L280",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("signAndbroadcast")]),g("OutboundLink")],1),e._v(" function "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/signingstargateclient.ts#L318-L325",target:"_blank",rel:"noopener noreferrer"}},[e._v("fetches the "),g("code",[e._v("sequence")]),g("OutboundLink")],1),e._v(" number from the blockchain.")])]),e._v(" "),g("p",[e._v("In other words, the signing client can only know about the transactions that have been included in a block. It has no idea whether there are already pending transactions with a higher "),g("code",[e._v("sequence")]),e._v(" that would result in the account's "),g("code",[e._v("sequence")]),e._v(" being higher when your poorly crafted transaction is checked, therefore causing it to be rejected.")]),e._v(" "),g("p",[e._v("Fortunately, the "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/signingstargateclient.ts#L310",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("sign")]),g("OutboundLink")],1),e._v(" function can take "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/signingstargateclient.ts#L315",target:"_blank",rel:"noopener noreferrer"}},[e._v("any sequence number"),g("OutboundLink")],1),e._v(". You will therefore force the sequence number to the one you know to be right eventually:")]),e._v(" "),g("ol",[g("li",[e._v("It will start at the number as fetched from the blockchain.")]),e._v(" "),g("li",[e._v("Whenever you sign a new transaction you will increment this sequence number and keep track of it in your own variable.")])]),e._v(" "),g("p",[e._v("Because JavaScript has low assurances when it comes to threading, you need to make sure that each "),g("code",[e._v("sign")]),e._v(" command happens after the previous one, or your "),g("code",[e._v("sequence")]),e._v(" incrementing may get messed up. For that, you should not use "),g("code",[e._v("Promise.all")]),e._v(", or something like "),g("code",[e._v("array.forEach(() => { await })")]),e._v(", which fire all promises roughly at the same time. Instead you will use a "),g("code",[e._v("while() { await }")]),e._v(" pattern.")]),e._v(" "),g("p",[e._v("There is a "),g("strong",[e._v("second difficulty")]),e._v(" when you want to send that many signed transactions. The client's "),g("code",[e._v("broadcastTx")]),e._v(" function "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/stargateclient.ts#L420-L424",target:"_blank",rel:"noopener noreferrer"}},[e._v("waits for it"),g("OutboundLink")],1),e._v(" to be included in a block, which would defeat the purpose of signing separately. Fortunately, if you look into its content, you can see that it calls "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/stargate/src/stargateclient.ts#L410",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("this.forceGetTmClient().broadcastTxSync")]),g("OutboundLink")],1),e._v(". This Tendermint client function returns only "),g("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/packages/tendermint-rpc/src/tendermint34/tendermint34client.ts#L172",target:"_blank",rel:"noopener noreferrer"}},[e._v("the hash"),g("OutboundLink")],1),e._v(", that is "),g("em",[e._v("before any inclusion in a block")]),e._v(".")]),e._v(" "),g("p",[e._v("On the other hand, you want the last transaction to be included in the block so that when you query for the stored game you get the expected values. Therefore you will:")]),e._v(" "),g("ol",[g("li",[e._v("Send the first 21 signed transactions with the "),g("em",[e._v("fast")]),e._v(" "),g("code",[e._v("this.forceGetTmClient().broadcastTxSync")]),e._v(".")]),e._v(" "),g("li",[e._v("Send the last transaction with a "),g("em",[e._v("slow")]),e._v(" client "),g("code",[e._v("broadcastTx")]),e._v(".")])]),e._v(" "),g("p",[e._v('Here again, you need to make sure that you submit all transactions in sequential manner, otherwise a player may in effect try to play before their turn. At this point, you trust that Tendermint includes the transactions in the order in which they were submitted. If Tendermint does any shuffling between Alice and Bob, you may end up with a "play before their turn" error.')]),e._v(" "),g("p",[e._v("With luck, all transactions may end up in a single block, which would make the test 22 times faster than if you had waited for each transaction to get into its own block.")]),e._v(" "),g("HighlightBox",{attrs:{type:"learning"}},[g("p",[e._v("You would use the same techniques if you wanted to stress test your blockchain. This is why these paragraphs are more than just entertainment.")])]),e._v(" "),g("p",[e._v("Add a way to track the sequences of Alice and Bob:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW50ZXJmYWNlIFNob3J0QWNjb3VudEluZm8gewogICAgYWNjb3VudE51bWJlcjogbnVtYmVyCiAgICBzZXF1ZW5jZTogbnVtYmVyCn0KY29uc3QgZ2V0U2hvcnRBY2NvdW50SW5mbyA9IGFzeW5jICh3aG86IHN0cmluZyk6IFByb21pc2UmbHQ7U2hvcnRBY2NvdW50SW5mbyZndDsgPSZndDsgewogICAgY29uc3QgYWNjb3VudEluZm86IEFjY291bnQgPSAoYXdhaXQgYWxpY2VDbGllbnQuZ2V0QWNjb3VudCh3aG8pKSEKICAgIHJldHVybiB7CiAgICAgICAgYWNjb3VudE51bWJlcjogYWNjb3VudEluZm8uYWNjb3VudE51bWJlciwKICAgICAgICBzZXF1ZW5jZTogYWNjb3VudEluZm8uc2VxdWVuY2UsCiAgICB9Cn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L120-L130"}}),e._v(" "),g("p",[e._v("Add helpers to pick the right Alice or Bob values:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3Qgd2hvc2VDbGllbnQgPSAod2hvOiBQbGF5ZXIpID0mZ3Q7ICh3aG8gPT0gJnF1b3Q7YiZxdW90OyA/IGFsaWNlQ2xpZW50IDogYm9iQ2xpZW50KQpjb25zdCB3aG9zZUFkZHJlc3MgPSAod2hvOiBQbGF5ZXIpID0mZ3Q7ICh3aG8gPT0gJnF1b3Q7YiZxdW90OyA/IGFsaWNlIDogYm9iKQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L131-L132"}}),e._v(" "),g("p",[e._v("Add a function to your client to give you access to Tendermint's "),g("code",[e._v("broadcastTxSync")]),e._v(":")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"cHVibGljIGFzeW5jIHRtQnJvYWRjYXN0VHhTeW5jKHR4OiBVaW50OEFycmF5KTogUHJvbWlzZSZsdDtCcm9hZGNhc3RUeFN5bmNSZXNwb25zZSZndDsgewogICAgcmV0dXJuIHRoaXMuZm9yY2VHZXRUbUNsaWVudCgpLmJyb2FkY2FzdFR4U3luYyh7IHR4IH0pCn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/checkers_stargateclient.ts#L23-L25"}}),e._v(" "),g("p",[e._v("Create your "),g("code",[e._v("it")]),e._v(" test with the necessary initializations:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aXQoJnF1b3Q7Y2FuIGNvbnRpbnVlIHRoZSBnYW1lIHVwIHRvIGJlZm9yZSB0aGUgZG91YmxlIGNhcHR1cmUmcXVvdDssIGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgIHRoaXMudGltZW91dCgxMF8wMDApCiAgICBjb25zdCBjbGllbnQ6IENoZWNrZXJzU3RhcmdhdGVDbGllbnQgPSBhd2FpdCBDaGVja2Vyc1N0YXJnYXRlQ2xpZW50LmNvbm5lY3QoUlBDX1VSTCkKICAgIGNvbnN0IGNoYWluSWQ6IHN0cmluZyA9IGF3YWl0IGNsaWVudC5nZXRDaGFpbklkKCkKICAgIGNvbnN0IGFjY291bnRJbmZvID0gewogICAgICAgIGI6IGF3YWl0IGdldFNob3J0QWNjb3VudEluZm8oYWxpY2UpLAogICAgICAgIHI6IGF3YWl0IGdldFNob3J0QWNjb3VudEluZm8oYm9iKSwKICAgIH0KICAgIC8vIFRPRE8KfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L134-L141"}}),e._v(" "),g("p",[e._v("Now get all 22 signed transactions, from index 2 to index 23:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgdHhMaXN0OiBUeFJhd1tdID0gW10KbGV0IHR4SW5kZXg6IG51bWJlciA9IDIKd2hpbGUgKHR4SW5kZXggJmx0OyAyNCkgewogICAgY29uc3QgZ2FtZU1vdmU6IEdhbWVNb3ZlID0gY29tcGxldGVHYW1lW3R4SW5kZXhdCiAgICB0eExpc3QucHVzaCgKICAgICAgICBhd2FpdCB3aG9zZUNsaWVudChnYW1lTW92ZS5wbGF5ZXIpLnNpZ24oCiAgICAgICAgICAgIHdob3NlQWRkcmVzcyhnYW1lTW92ZS5wbGF5ZXIpLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHlwZVVybDogdHlwZVVybE1zZ1BsYXlNb3ZlLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0b3I6IHdob3NlQWRkcmVzcyhnYW1lTW92ZS5wbGF5ZXIpLAogICAgICAgICAgICAgICAgICAgICAgICBnYW1lSW5kZXg6IGdhbWVJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbVg6IGdhbWVNb3ZlLmZyb20ueCwKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbVk6IGdhbWVNb3ZlLmZyb20ueSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9YOiBnYW1lTW92ZS50by54LAogICAgICAgICAgICAgICAgICAgICAgICB0b1k6IGdhbWVNb3ZlLnRvLnksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFtb3VudDogW3sgZGVub206ICZxdW90O3N0YWtlJnF1b3Q7LCBhbW91bnQ6ICZxdW90OzAmcXVvdDsgfV0sCiAgICAgICAgICAgICAgICBnYXM6ICZxdW90OzUwMDAwMCZxdW90OywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYHBsYXlpbmcgbW92ZSAke3R4SW5kZXh9YCwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYWNjb3VudE51bWJlcjogYWNjb3VudEluZm9bZ2FtZU1vdmUucGxheWVyXS5hY2NvdW50TnVtYmVyLAogICAgICAgICAgICAgICAgc2VxdWVuY2U6IGFjY291bnRJbmZvW2dhbWVNb3ZlLnBsYXllcl0uc2VxdWVuY2UrKywKICAgICAgICAgICAgICAgIGNoYWluSWQ6IGNoYWluSWQsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgICkKICAgIHR4SW5kZXgrKwp9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L142-L175"}}),e._v(" "),g("HighlightBox",{attrs:{type:"note"}},[g("p",[e._v("Note how:")]),e._v(" "),g("ol",[g("li",[e._v("The moves "),g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/player.ts#L15-L16",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("0")]),e._v(" and "),g("code",[e._v("1")]),g("OutboundLink")],1),e._v(" already took place in the previous "),g("code",[e._v("it")]),e._v(" test.")]),e._v(" "),g("li",[e._v("The gas fee can no longer be "),g("code",[e._v('"auto"')]),e._v(" and has to be set, here at a price of "),g("code",[e._v("0")]),e._v(". You may have to adjust this depending on your running chain.")]),e._v(" "),g("li",[e._v("The sequence number of the signer is increased "),g("strong",[e._v("after")]),e._v(" it has been used: "),g("code",[e._v(".sequence++")]),e._v(".")])])]),e._v(" "),g("p",[e._v("With all the transactions signed, you can "),g("em",[e._v("fire")]),e._v(" broadcast the first 21 of them:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgaGFzaGVzOiBCcm9hZGNhc3RUeFN5bmNSZXNwb25zZVtdID0gW10KdHhJbmRleCA9IDAKd2hpbGUgKHR4SW5kZXggJmx0OyB0eExpc3QubGVuZ3RoIC0gMSkgewogICAgY29uc3QgdHhSYXc6IFR4UmF3ID0gdHhMaXN0W3R4SW5kZXhdCiAgICBoYXNoZXMucHVzaChhd2FpdCBjbGllbnQudG1Ccm9hZGNhc3RUeFN5bmMoVHhSYXcuZW5jb2RlKHR4UmF3KS5maW5pc2goKSkpCiAgICB0eEluZGV4KysKfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L177-L183"}}),e._v(" "),g("p",[e._v("You now "),g("em",[e._v("normally")]),e._v(" broadcast the last one:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgbGFzdERlbGl2ZXI6IERlbGl2ZXJUeFJlc3BvbnNlID0gYXdhaXQgY2xpZW50LmJyb2FkY2FzdFR4KAogICAgVHhSYXcuZW5jb2RlKHR4TGlzdFt0eExpc3QubGVuZ3RoIC0gMV0pLmZpbmlzaCgpLAopCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L185-L187"}}),e._v(" "),g("p",[e._v("If you are interested, you can log the blocks in which the transactions were included:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc29sZS5sb2coCiAgICB0eExpc3QubGVuZ3RoLAogICAgJnF1b3Q7dHJhbnNhY3Rpb25zIGluY2x1ZGVkIGluIGJsb2NrcyBmcm9tJnF1b3Q7LAogICAgKGF3YWl0IGNsaWVudC5nZXRUeCh0b0hleChoYXNoZXNbMF0uaGFzaCkpKSEuaGVpZ2h0LAogICAgJnF1b3Q7dG8mcXVvdDssCiAgICBsYXN0RGVsaXZlci5oZWlnaHQsCikK",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L189-L195"}}),e._v(" "),g("p",[e._v("Lastly, make sure that the game has the expected board:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgZ2FtZTogU3RvcmVkR2FtZSA9IChhd2FpdCBjaGVja2Vycy5nZXRTdG9yZWRHYW1lKGdhbWVJbmRleCkpIQpleHBlY3QoZ2FtZS5ib2FyZCkudG8uZXF1YWwoJnF1b3Q7KmIqYioqKmJ8KipiKmIqKip8KioqYioqKnJ8KioqKioqKip8KioqcioqKip8KioqKioqKip8KioqcioqKip8cipCKnIqciomcXVvdDspCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L197-L198"}}),e._v(" "),g("p",[e._v("You have now brought the game up to the point just before the black player can capture two pieces in two moves.")]),e._v(" "),g("h3",{attrs:{id:"combine-messages"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#combine-messages"}},[e._v("#")]),e._v(" Combine messages")]),e._v(" "),g("p",[e._v("Alice, the black player can capture "),g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/src/types/checkers/player.ts#L39-L41",target:"_blank",rel:"noopener noreferrer"}},[e._v("two pieces in one turn"),g("OutboundLink")],1),e._v(". The checkers rules allow that.")]),e._v(" "),g("p",[e._v("You are now ready to send that one transaction with the two messages with the use of "),g("code",[e._v("signAndBroadcast")]),e._v(". Add an "),g("code",[e._v("it")]),e._v(" test with the right initializations:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aXQoJnF1b3Q7Y2FuIHNlbmQgYSBkb3VibGUgY2FwdHVyZSBtb3ZlJnF1b3Q7LCBhc3luYyBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnRpbWVvdXQoNV8wMDApCiAgICBjb25zdCBmaXJzdENhcHR1cmVNb3ZlOiBHYW1lTW92ZSA9IGNvbXBsZXRlR2FtZVsyNF0KICAgIGNvbnN0IHNlY29uZENhcHR1cmVNb3ZlOiBHYW1lTW92ZSA9IGNvbXBsZXRlR2FtZVsyNV0KICAgIC8vIFRPRE8KfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L202-L204"}}),e._v(" "),g("p",[e._v("In it, make the call with the correctly crafted messages.")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgcmVzcG9uc2U6IERlbGl2ZXJUeFJlc3BvbnNlID0gYXdhaXQgYWxpY2VDbGllbnQuc2lnbkFuZEJyb2FkY2FzdCgKICAgIGFsaWNlLAogICAgWwogICAgICAgIHsKICAgICAgICAgICAgdHlwZVVybDogdHlwZVVybE1zZ1BsYXlNb3ZlLAogICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgY3JlYXRvcjogYWxpY2UsCiAgICAgICAgICAgICAgICBnYW1lSW5kZXg6IGdhbWVJbmRleCwKICAgICAgICAgICAgICAgIGZyb21YOiBmaXJzdENhcHR1cmVNb3ZlLmZyb20ueCwKICAgICAgICAgICAgICAgIGZyb21ZOiBmaXJzdENhcHR1cmVNb3ZlLmZyb20ueSwKICAgICAgICAgICAgICAgIHRvWDogZmlyc3RDYXB0dXJlTW92ZS50by54LAogICAgICAgICAgICAgICAgdG9ZOiBmaXJzdENhcHR1cmVNb3ZlLnRvLnksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIHR5cGVVcmw6IHR5cGVVcmxNc2dQbGF5TW92ZSwKICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgIGNyZWF0b3I6IGFsaWNlLAogICAgICAgICAgICAgICAgZ2FtZUluZGV4OiBnYW1lSW5kZXgsCiAgICAgICAgICAgICAgICBmcm9tWDogc2Vjb25kQ2FwdHVyZU1vdmUuZnJvbS54LAogICAgICAgICAgICAgICAgZnJvbVk6IHNlY29uZENhcHR1cmVNb3ZlLmZyb20ueSwKICAgICAgICAgICAgICAgIHRvWDogc2Vjb25kQ2FwdHVyZU1vdmUudG8ueCwKICAgICAgICAgICAgICAgIHRvWTogc2Vjb25kQ2FwdHVyZU1vdmUudG8ueSwKICAgICAgICAgICAgfSwKICAgICAgICB9LAogICAgXSwKICAgICZxdW90O2F1dG8mcXVvdDssCikK",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L205-L232"}}),e._v(" "),g("p",[e._v("Next, collect the events and confirm they match your expectations:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgbG9nczogTG9nW10gPSBKU09OLnBhcnNlKHJlc3BvbnNlLnJhd0xvZyEpCmV4cGVjdChsb2dzKS50by5iZS5sZW5ndGgoMikKZXhwZWN0KGdldENhcHR1cmVkUG9zKGdldE1vdmVQbGF5ZWRFdmVudChsb2dzWzBdKSEpKS50by5kZWVwLmVxdWFsKHsKICAgIHg6IDMsCiAgICB5OiA2LAp9KQpleHBlY3QoZ2V0Q2FwdHVyZWRQb3MoZ2V0TW92ZVBsYXllZEV2ZW50KGxvZ3NbMV0pISkpLnRvLmRlZXAuZXF1YWwoewogICAgeDogMywKICAgIHk6IDQsCn0pCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L233-L242"}}),e._v(" "),g("HighlightBox",{attrs:{type:"note"}},[g("p",[e._v("Note how it checks the logs for the captured attributes. In effect, a captured piece has "),g("code",[e._v("x")]),e._v(" and "),g("code",[e._v("y")]),e._v(" as the average of the respective "),g("code",[e._v("from")]),e._v(" and "),g("code",[e._v("to")]),e._v(" positions' fields.")])]),e._v(" "),g("p",[e._v("Sending a single transaction with two moves is cheaper and faster, from the point of view of the player, than sending two separate ones for the same effect.")]),e._v(" "),g("HighlightBox",{attrs:{type:"note"}},[g("p",[e._v("It is not possible for Alice, who is the creator and black player, to send in a single transaction a message for creation and a message to make the first move on it. That's because the index of the game is not known before the transaction has been included in a block, and with that the index computed.")])]),e._v(" "),g("h3",{attrs:{id:"further-tests"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#further-tests"}},[e._v("#")]),e._v(" Further tests")]),e._v(" "),g("p",[e._v("You can add further tests, for instance:")]),e._v(" "),g("ol",[g("li",[e._v("To see what happens when you continue playing the game "),g("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/signing-stargate/test/integration/stored-game-action.ts#L245-L312",target:"_blank",rel:"noopener noreferrer"}},[e._v("up to its completion"),g("OutboundLink")],1),e._v(".")]),e._v(" "),g("li",[e._v("To reject a game.")])]),e._v(" "),g("HighlightBox",{attrs:{type:"synopsis"}},[g("p",[e._v("To summarize, this section has explored:")]),e._v(" "),g("ul",[g("li",[e._v("How to create the elements necessary for you to begin sending transactions to your checkers blockchain, including encodable messages, a signing client, and action methods that permit interaction with the blockchain.")]),e._v(" "),g("li",[e._v("How to test your signing client, including key preparation (with either a mnemonic or a private key) and client preparation, followed by functions such as creating a game, rejecting a game, or playing a move.")])])])],1)}),[],!1,null,null,null);t.default=o.exports}}]);